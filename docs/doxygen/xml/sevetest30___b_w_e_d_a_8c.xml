<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.13.2" xml:lang="zh">
  <compounddef id="sevetest30___b_w_e_d_a_8c" kind="file" language="C++">
    <compoundname>sevetest30_BWEDA.c</compoundname>
    <includes refid="sevetest30___b_w_e_d_a_8h" local="yes">sevetest30_BWEDA.h</includes>
    <includes refid="board__def_8h" local="yes">board_def.h</includes>
    <includes refid="board__ctrl_8h" local="yes">board_ctrl.h</includes>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="yes">freertos/FreeRTOS.h</includes>
    <includes local="yes">freertos/task.h</includes>
    <includes local="yes">freertos/event_groups.h</includes>
    <includes local="yes">esp_system.h</includes>
    <includes local="yes">esp_log.h</includes>
    <includes local="yes">nvs_flash.h</includes>
    <includes local="yes">esp_bt.h</includes>
    <includes local="yes">esp_gap_ble_api.h</includes>
    <includes local="yes">esp_gatts_api.h</includes>
    <includes local="yes">esp_bt_main.h</includes>
    <includes local="yes">esp_gatt_common_api.h</includes>
    <incdepgraph>
      <node id="8">
        <label>board_ctrl.h</label>
        <link refid="board__ctrl_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>board_def.h</label>
        <link refid="board__def_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>BL5372.h</label>
        <link refid="_b_l5372_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>TCA6416A.h</label>
        <link refid="_t_c_a6416_a_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>sevetest30_BWEDA.h</label>
        <link refid="sevetest30___b_w_e_d_a_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>sevetest30_gpio.h</label>
        <link refid="sevetest30__gpio_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>main/sevetest30_BWEDA.c</label>
        <link refid="sevetest30___b_w_e_d_a_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>audio_hal.h</label>
      </node>
      <node id="6">
        <label>driver/i2c.h</label>
      </node>
      <node id="15">
        <label>driver/spi_common.h</label>
      </node>
      <node id="16">
        <label>driver/spi_master.h</label>
      </node>
      <node id="27">
        <label>esp_bt.h</label>
      </node>
      <node id="29">
        <label>esp_bt_main.h</label>
      </node>
      <node id="3">
        <label>esp_err.h</label>
      </node>
      <node id="28">
        <label>esp_gap_ble_api.h</label>
      </node>
      <node id="30">
        <label>esp_gatt_common_api.h</label>
      </node>
      <node id="7">
        <label>esp_gatts_api.h</label>
      </node>
      <node id="25">
        <label>esp_log.h</label>
      </node>
      <node id="17">
        <label>esp_peripherals.h</label>
      </node>
      <node id="24">
        <label>esp_system.h</label>
      </node>
      <node id="9">
        <label>esp_types.h</label>
      </node>
      <node id="11">
        <label>esxxx_common.h</label>
      </node>
      <node id="21">
        <label>freertos/FreeRTOS.h</label>
      </node>
      <node id="23">
        <label>freertos/event_groups.h</label>
      </node>
      <node id="22">
        <label>freertos/task.h</label>
      </node>
      <node id="26">
        <label>nvs_flash.h</label>
      </node>
      <node id="14">
        <label>stdbool.h</label>
      </node>
      <node id="19">
        <label>stdio.h</label>
      </node>
      <node id="20">
        <label>stdlib.h</label>
      </node>
      <node id="10">
        <label>string.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structprepare__type__env__t" prot="public">prepare_type_env_t</innerclass>
    <innerclass refid="structgatts__profile__inst" prot="public">gatts_profile_inst</innerclass>
    <sectiondef kind="define">
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a7f58e13befd440c6ec2fba126a64c013" prot="public" static="no">
        <name>ESP_APP_ID</name>
        <initializer>0x55</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="52" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="52" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1ae54f817fcc69f4bc2b95dec2288d4880" prot="public" static="no">
        <name>SVC_INST_ID</name>
        <initializer>0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="54" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="54" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a5d2f5677517e7c8fd4ee8e2287ebec3b" prot="public" static="no">
        <name>ADV_CONFIG_FLAG</name>
        <initializer>(1 &lt;&lt; 0)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="56" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="56" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1ad92fd6350531e23c955c71626296406c" prot="public" static="no">
        <name>SCAN_RSP_CONFIG_FLAG</name>
        <initializer>(1 &lt;&lt; 1)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="57" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="57" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a2b81bffeb6a116bdbf1ab31a72dd65e4" prot="public" static="no">
        <name>SERV_UUID_AUTOMATION_IO</name>
        <initializer>0x1815</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="117" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="117" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a18c367b24b62ea7c348df3663df305ae" prot="public" static="no">
        <name>SERV_UUID_GENERIC_MEDIA_CONTROL</name>
        <initializer>0x1849</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="118" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="118" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a94e6830498933c86fbd3a389fae96758" prot="public" static="no">
        <name>CHAR_UUID_ACS_DATA_OUT_NOTIFY</name>
        <initializer>0x2B31</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="121" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="121" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" prot="public" static="no">
        <name>CHAR_UUID_ACS_DATA_OUT_INDICATE</name>
        <initializer>0x2B32</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="122" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="122" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a8772640cb9ab74e3aad846d657bc3419" prot="public" static="no">
        <name>BLE_SERVICE_IO_CTRL_UUID16</name>
        <initializer>(<ref refid="sevetest30___b_w_e_d_a_8c_1a2b81bffeb6a116bdbf1ab31a72dd65e4" kindref="member">SERV_UUID_AUTOMATION_IO</ref>)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="162" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="162" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="sevetest30___b_w_e_d_a_8c_1a9a00abf5ebe37d88d7a548990c08f33b" prot="public" static="no">
        <name>BLE_SERVICE_MEDIA_CTRL_UUID16</name>
        <initializer><ref refid="sevetest30___b_w_e_d_a_8c_1a18c367b24b62ea7c348df3663df305ae" kindref="member">SERV_UUID_GENERIC_MEDIA_CONTROL</ref></initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="207" column="9" bodyfile="main/sevetest30_BWEDA.c" bodystart="207" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="enum">
      <memberdef kind="enum" id="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9" prot="public" static="no" strong="no">
        <type></type>
        <name></name>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9aafaeb90cd4b310beb1e5f2870e03a773" prot="public">
          <name>IO_CTRL_PROFILE_APP</name>
          <initializer>= 0</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a2f711ca81ede538ca558e5addcb2b190" prot="public">
          <name>MEDIA_CTRL_PROFILE_APP</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a0456ce963a48c5e10132778db64ceb77" prot="public">
          <name>PROFILE_NUM</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="90" column="1" bodyfile="main/sevetest30_BWEDA.c" bodystart="91" bodyend="96"/>
      </memberdef>
      <memberdef kind="enum" id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcb" prot="public" static="no" strong="no">
        <type></type>
        <name></name>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba93e10c5f69a18fb3240d805283f5b68c" prot="public">
          <name>SE30_CHAR_UUID_MIN</name>
          <initializer>= 0</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba914d77909c78391e605003659de4a8fb" prot="public">
          <name>SE30_CHAR_UUID_1</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba9baa035d356da7a185d43885973f9b33" prot="public">
          <name>SE30_CHAR_UUID_2</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbae0de20e9e0006b6006945833f53b7113" prot="public">
          <name>SE30_CHAR_UUID_3</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbac0326642c9fc4699da38d35892e49015" prot="public">
          <name>SE30_CHAR_UUID_4</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba22301769dbe723670bde7bc799c38035" prot="public">
          <name>SE30_CHAR_UUID_5</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba053738fee9e3ae90c29e02d7d7b7bfb1" prot="public">
          <name>SE30_CHAR_UUID_6</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba6468eaeb48517fba6d8b0e938ab391e2" prot="public">
          <name>SE30_CHAR_UUID_7</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba7d647484e9305152a0bbb85645c1852a" prot="public">
          <name>SE30_CHAR_UUID_8</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbaee7ba995368f991a3b39a25b9b49b2b6" prot="public">
          <name>SE30_CHAR_UUID_9</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba0876efd58b493213d65fb314ed152303" prot="public">
          <name>SE30_CHAR_UUID_10</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbacdf44f5d171961e0af372063d876ba50" prot="public">
          <name>SE30_CHAR_UUID_11</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba5c1a8ca65052cf9d1e21fcb3973f1d29" prot="public">
          <name>SE30_CHAR_UUID_12</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbaf057a8cd3b9221682e29592ecd731f93" prot="public">
          <name>SE30_CHAR_UUID_13</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba931b6859e83535fc5b37123210d846f0" prot="public">
          <name>SE30_CHAR_UUID_14</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba70dee06ffa91b209e45e6690f92a2732" prot="public">
          <name>SE30_CHAR_UUID_15</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba88b10ca8827b7ad7c17b9a340da48068" prot="public">
          <name>SE30_CHAR_UUID_MAX</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="126" column="1" bodyfile="main/sevetest30_BWEDA.c" bodystart="127" bodyend="147"/>
      </memberdef>
      <memberdef kind="enum" id="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45" prot="public" static="no" strong="no">
        <type></type>
        <name></name>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45a9aaa6fd7c050fa923bc14e46a58c19f7" prot="public">
          <name>IO_CTRL_SERVICE</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45adda65ba93d55b1269b7956ef865c97a3" prot="public">
          <name>IO_CTRL_EN_DISPLAY_CHAR</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45ac11ab5acad6a1c3bfe54518e2913fd22" prot="public">
          <name>IO_CTRL_EN_DISPLAY_VALUE</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45aea0f9735f12f080d283855cf9b9395be" prot="public">
          <name>IO_CTRL_IDX_NB</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="165" column="1" bodyfile="main/sevetest30_BWEDA.c" bodystart="166" bodyend="174"/>
      </memberdef>
      <memberdef kind="enum" id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcb" prot="public" static="no" strong="no">
        <type></type>
        <name></name>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf5983682960bf9927095dcbc41fe8333" prot="public">
          <name>MEDIA_CTRL_SERVICE</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba4e620c32074a4fef90bc84a0ade3f371" prot="public">
          <name>MEDIA_CTRL_VOL_AMP_CHAR</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" prot="public">
          <name>MEDIA_CTRL_VOL_AMP_VALUE</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2470c90ab387e9b75c7d5fb01c868a16" prot="public">
          <name>MEDIA_CTRL_VOL_AMP_CFG</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaa503893e057d12c77084e1e4b948586b" prot="public">
          <name>MEDIA_CTRL_MUTE_AMP_CHAR</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" prot="public">
          <name>MEDIA_CTRL_MUTE_AMP_VALUE</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba7ada8457ec1fdcb054b2599468e58f41" prot="public">
          <name>MEDIA_CTRL_MUTE_AMP_CFG</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbae8432910de733803f8c482c3f39573fe" prot="public">
          <name>MEDIA_CTRL_IDX_NB</name>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="210" column="1" bodyfile="main/sevetest30_BWEDA.c" bodystart="211" bodyend="223"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="var">
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" prot="public" static="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t adv_config_done</definition>
        <argsstring></argsstring>
        <name>adv_config_done</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="59" column="16" bodyfile="main/sevetest30_BWEDA.c" bodystart="59" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" prot="public" static="yes" mutable="no">
        <type><ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref></type>
        <definition>prepare_type_env_t prepare_write_env</definition>
        <argsstring></argsstring>
        <name>prepare_write_env</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="85" column="27" bodyfile="main/sevetest30_BWEDA.c" bodystart="85" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" prot="public" static="yes" mutable="no">
        <type>struct <ref refid="structgatts__profile__inst" kindref="compound">gatts_profile_inst</ref></type>
        <definition>struct gatts_profile_inst app_profile_table[PROFILE_NUM]</definition>
        <argsstring>[PROFILE_NUM]</argsstring>
        <name>app_profile_table</name>
        <initializer>= {
    [<ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9aafaeb90cd4b310beb1e5f2870e03a773" kindref="member">IO_CTRL_PROFILE_APP</ref>] = {
        .gatts_cb = <ref refid="sevetest30___b_w_e_d_a_8c_1ab6595366a5a836bb0ad25fe855930620" kindref="member">IO_CTRL_SERVICE_profile_handler</ref>,
        .gatts_if = ESP_GATT_IF_NONE,
    },

    [<ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a2f711ca81ede538ca558e5addcb2b190" kindref="member">MEDIA_CTRL_PROFILE_APP</ref>] = {
        .gatts_cb = <ref refid="sevetest30___b_w_e_d_a_8c_1af4165e8b4c92675941e0c4a497421ac6" kindref="member">MEDIA_CTRL_SERVICE_profile_handler</ref>,
        .gatts_if = ESP_GATT_IF_NONE,
    },

}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line=CONFIG_WIFI_SSID column="32" bodyfile="main/sevetest30_BWEDA.c" bodystart=CONFIG_WIFI_SSID bodyend="113"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a906dfab674e5b65aa8b2020087e66c50" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t primary_service_uuid</definition>
        <argsstring></argsstring>
        <name>primary_service_uuid</name>
        <initializer>= ESP_GATT_UUID_PRI_SERVICE</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="151" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="151" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a8dbb0e6a5920e94c0473e375558f7265" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t character_declaration_uuid</definition>
        <argsstring></argsstring>
        <name>character_declaration_uuid</name>
        <initializer>= ESP_GATT_UUID_CHAR_DECLARE</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="152" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="152" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1add4f5ff5fc585021ed07e339b0ef936f" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t character_client_config_uuid</definition>
        <argsstring></argsstring>
        <name>character_client_config_uuid</name>
        <initializer>= ESP_GATT_UUID_CHAR_CLIENT_CONFIG</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="153" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="153" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1ad1d27d47c7fd785c27d90f977ceb3c9e" prot="public" static="yes" mutable="no">
        <type>const uint8_t</type>
        <definition>const uint8_t char_prop_read_write_notify</definition>
        <argsstring></argsstring>
        <name>char_prop_read_write_notify</name>
        <initializer>= ESP_GATT_CHAR_PROP_BIT_WRITE | ESP_GATT_CHAR_PROP_BIT_READ | ESP_GATT_CHAR_PROP_BIT_NOTIFY</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="158" column="22" bodyfile="main/sevetest30_BWEDA.c" bodystart="158" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a6216759639ba936214a16ceed081db9f" prot="public" static="no" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t io_ctrl_service_handle_table[IO_CTRL_IDX_NB]</definition>
        <argsstring>[IO_CTRL_IDX_NB]</argsstring>
        <name>io_ctrl_service_handle_table</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="177" column="10" bodyfile="main/sevetest30_BWEDA.c" bodystart="177" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a2604258a5b8872487a419c42e2bda5f8" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t io_ctrl_service_uuid</definition>
        <argsstring></argsstring>
        <name>io_ctrl_service_uuid</name>
        <initializer>= <ref refid="sevetest30___b_w_e_d_a_8c_1a8772640cb9ab74e3aad846d657bc3419" kindref="member">BLE_SERVICE_IO_CTRL_UUID16</ref></initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="180" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="180" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1af1c49502efc8ab4a26414ee488137b22" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t io_ctrl_uuid_buf_1</definition>
        <argsstring></argsstring>
        <name>io_ctrl_uuid_buf_1</name>
        <initializer>= <ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba914d77909c78391e605003659de4a8fb" kindref="member">SE30_CHAR_UUID_1</ref></initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="182" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="182" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a3d4804e1bd925789002f9d43979fd091" prot="public" static="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t io_ctrl_display_en</definition>
        <argsstring></argsstring>
        <name>io_ctrl_display_en</name>
        <initializer>= true</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="184" column="16" bodyfile="main/sevetest30_BWEDA.c" bodystart="184" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a368f93fc68770506027b0b81b36414c7" prot="public" static="yes" mutable="no">
        <type>const esp_gatts_attr_db_t</type>
        <definition>const esp_gatts_attr_db_t io_ctrl_gatt_database[IO_CTRL_IDX_NB]</definition>
        <argsstring>[IO_CTRL_IDX_NB]</argsstring>
        <name>io_ctrl_gatt_database</name>
        <initializer>=
    {
        [<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45a9aaa6fd7c050fa923bc14e46a58c19f7" kindref="member">IO_CTRL_SERVICE</ref>] = {
            {ESP_GATT_AUTO_RSP},
            {ESP_UUID_LEN_16, (uint8_t *)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a906dfab674e5b65aa8b2020087e66c50" kindref="member">primary_service_uuid</ref>,
             ESP_GATT_PERM_READ,
             sizeof(uint16_t), sizeof(<ref refid="sevetest30___b_w_e_d_a_8c_1a2604258a5b8872487a419c42e2bda5f8" kindref="member">io_ctrl_service_uuid</ref>), (uint8_t *)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a2604258a5b8872487a419c42e2bda5f8" kindref="member">io_ctrl_service_uuid</ref>}},

        [<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45adda65ba93d55b1269b7956ef865c97a3" kindref="member">IO_CTRL_EN_DISPLAY_CHAR</ref>] = {{ESP_GATT_AUTO_RSP}, {ESP_UUID_LEN_16, (uint8_t *)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a8dbb0e6a5920e94c0473e375558f7265" kindref="member">character_declaration_uuid</ref>, ESP_GATT_PERM_READ, sizeof(uint8_t), sizeof(uint8_t), (uint8_t *)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1ad1d27d47c7fd785c27d90f977ceb3c9e" kindref="member">char_prop_read_write_notify</ref>}},

        [<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45ac11ab5acad6a1c3bfe54518e2913fd22" kindref="member">IO_CTRL_EN_DISPLAY_VALUE</ref>] = {{ESP_GATT_AUTO_RSP}, {ESP_UUID_LEN_16, (uint8_t *)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1af1c49502efc8ab4a26414ee488137b22" kindref="member">io_ctrl_uuid_buf_1</ref>, ESP_GATT_PERM_READ | ESP_GATT_PERM_WRITE, sizeof(uint8_t), sizeof(uint8_t), (uint8_t *)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a3d4804e1bd925789002f9d43979fd091" kindref="member">io_ctrl_display_en</ref>}},

}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="190" column="34" bodyfile="main/sevetest30_BWEDA.c" bodystart="190" bodyend="202"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" prot="public" static="no" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t media_ctrl_service_handle_table[MEDIA_CTRL_IDX_NB]</definition>
        <argsstring>[MEDIA_CTRL_IDX_NB]</argsstring>
        <name>media_ctrl_service_handle_table</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="226" column="10" bodyfile="main/sevetest30_BWEDA.c" bodystart="226" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1aa6f078e79fa66dc43a987b567c920ef6" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t media_ctrl_service_uuid</definition>
        <argsstring></argsstring>
        <name>media_ctrl_service_uuid</name>
        <initializer>= <ref refid="sevetest30___b_w_e_d_a_8c_1a9a00abf5ebe37d88d7a548990c08f33b" kindref="member">BLE_SERVICE_MEDIA_CTRL_UUID16</ref></initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="229" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="229" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a3d368b240335e7e8eb7435724ac96f87" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t media_ctrl_uuid_buf_1</definition>
        <argsstring></argsstring>
        <name>media_ctrl_uuid_buf_1</name>
        <initializer>= <ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba9baa035d356da7a185d43885973f9b33" kindref="member">SE30_CHAR_UUID_2</ref></initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="231" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="231" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a6e7e35d5a2a04c3bd106c60beab9e905" prot="public" static="yes" mutable="no">
        <type>const uint16_t</type>
        <definition>const uint16_t media_ctrl_uuid_buf_2</definition>
        <argsstring></argsstring>
        <name>media_ctrl_uuid_buf_2</name>
        <initializer>= <ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbae0de20e9e0006b6006945833f53b7113" kindref="member">SE30_CHAR_UUID_3</ref></initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="232" column="23" bodyfile="main/sevetest30_BWEDA.c" bodystart="232" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" prot="public" static="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t media_ctrl_amp_vol_buf</definition>
        <argsstring></argsstring>
        <name>media_ctrl_amp_vol_buf</name>
        <initializer>= 0x00</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="234" column="16" bodyfile="main/sevetest30_BWEDA.c" bodystart="234" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" prot="public" static="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t media_ctrl_amp_mute_buf</definition>
        <argsstring></argsstring>
        <name>media_ctrl_amp_mute_buf</name>
        <initializer>= false</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="235" column="16" bodyfile="main/sevetest30_BWEDA.c" bodystart="235" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" prot="public" static="yes" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t media_ctrl_cfg_buf1</definition>
        <argsstring></argsstring>
        <name>media_ctrl_cfg_buf1</name>
        <initializer>= 0x0000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="237" column="17" bodyfile="main/sevetest30_BWEDA.c" bodystart="237" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" prot="public" static="yes" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t media_ctrl_cfg_buf2</definition>
        <argsstring></argsstring>
        <name>media_ctrl_cfg_buf2</name>
        <initializer>= 0x0000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="238" column="17" bodyfile="main/sevetest30_BWEDA.c" bodystart="238" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1abc2f05fededbd7b5dd6eecb033fe99ff" prot="public" static="yes" mutable="no">
        <type>const esp_gatts_attr_db_t</type>
        <definition>const esp_gatts_attr_db_t media_ctrl_gatt_database[MEDIA_CTRL_IDX_NB]</definition>
        <argsstring>[MEDIA_CTRL_IDX_NB]</argsstring>
        <name>media_ctrl_gatt_database</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="244" column="34" bodyfile="main/sevetest30_BWEDA.c" bodystart="244" bodyend="282"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a4c742bc6850d9fb422de10f998f727ac" prot="public" static="yes" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t adv_key_service_uuid[ESP_UUID_LEN_128]</definition>
        <argsstring>[ESP_UUID_LEN_128]</argsstring>
        <name>adv_key_service_uuid</name>
        <initializer>= <ref refid="sevetest30___b_w_e_d_a_8h_1aef76149f1648102db9e3eadf4f8edc13" kindref="member">BLE_SERVICE_UUID_BASE</ref>(<ref refid="sevetest30___b_w_e_d_a_8c_1a8772640cb9ab74e3aad846d657bc3419" kindref="member">BLE_SERVICE_IO_CTRL_UUID16</ref>)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="286" column="16" bodyfile="main/sevetest30_BWEDA.c" bodystart="286" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1a4f6bab3fd366271d5588e91a6420e0b0" prot="public" static="yes" mutable="no">
        <type>esp_ble_adv_data_t</type>
        <definition>esp_ble_adv_data_t adv_data</definition>
        <argsstring></argsstring>
        <name>adv_data</name>
        <initializer>= {
    .set_scan_rsp = false,                                                
    .include_name = true,                                                 
    .include_txpower = true,                                              
    .min_interval = 0x0006,                                               
    .max_interval = 0x0010,                                               
    .appearance = <ref refid="sevetest30___b_w_e_d_a_8h_1a2af4be4a9bdf7f8aa7c4e5decbc725f5" kindref="member">BLE_DEVICE_APPEARANCE_VALUE</ref>,                            
    .manufacturer_len = 0,                                                
    .p_manufacturer_data = NULL,                                          
    .service_data_len = 0,                                                
    .p_service_data = NULL,                                               
    .service_uuid_len = 0,                                                
    .p_service_uuid = NULL,                                               
    .flag = (ESP_BLE_ADV_FLAG_GEN_DISC | ESP_BLE_ADV_FLAG_BREDR_NOT_SPT), 
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="289" column="27" bodyfile="main/sevetest30_BWEDA.c" bodystart="289" bodyend="303"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1af5fb860dba0137132e1b5d606e56beee" prot="public" static="yes" mutable="no">
        <type>esp_ble_adv_data_t</type>
        <definition>esp_ble_adv_data_t scan_rsp_data</definition>
        <argsstring></argsstring>
        <name>scan_rsp_data</name>
        <initializer>= {
    .set_scan_rsp = true,     
    .include_name = false,    
    .include_txpower = false, 
    .min_interval = 0x0006,
    .max_interval = 0x0010,
    .appearance = <ref refid="sevetest30___b_w_e_d_a_8h_1a2af4be4a9bdf7f8aa7c4e5decbc725f5" kindref="member">BLE_DEVICE_APPEARANCE_VALUE</ref>, 
    .manufacturer_len = 0,
    .p_manufacturer_data = NULL,
    .service_data_len = 0,
    .p_service_data = NULL,
    .service_uuid_len = sizeof(<ref refid="sevetest30___b_w_e_d_a_8c_1a4c742bc6850d9fb422de10f998f727ac" kindref="member">adv_key_service_uuid</ref>), 
    .p_service_uuid = <ref refid="sevetest30___b_w_e_d_a_8c_1a4c742bc6850d9fb422de10f998f727ac" kindref="member">adv_key_service_uuid</ref>,           
    .flag = (ESP_BLE_ADV_FLAG_GEN_DISC | ESP_BLE_ADV_FLAG_BREDR_NOT_SPT),
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="306" column="27" bodyfile="main/sevetest30_BWEDA.c" bodystart="306" bodyend="320"/>
      </memberdef>
      <memberdef kind="variable" id="sevetest30___b_w_e_d_a_8c_1abee55223218f5469c9399d8b5503663e" prot="public" static="yes" mutable="no">
        <type>esp_ble_adv_params_t</type>
        <definition>esp_ble_adv_params_t adv_params</definition>
        <argsstring></argsstring>
        <name>adv_params</name>
        <initializer>= {
    .adv_int_min = 0x20,                                    
    .adv_int_max = 0x40,                                    
    .adv_type = ADV_TYPE_IND,                               
    .own_addr_type = BLE_ADDR_TYPE_PUBLIC,                  
    .channel_map = ADV_CHNL_ALL,                            
    .adv_filter_policy = ADV_FILTER_ALLOW_SCAN_ANY_CON_ANY, 
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="323" column="29" bodyfile="main/sevetest30_BWEDA.c" bodystart="323" bodyend="330"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1ab6595366a5a836bb0ad25fe855930620" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void IO_CTRL_SERVICE_profile_handler</definition>
        <argsstring>(esp_gatts_cb_event_t event, esp_gatt_if_t gatts_if, esp_ble_gatts_cb_param_t *param)</argsstring>
        <name>IO_CTRL_SERVICE_profile_handler</name>
        <param>
          <type>esp_gatts_cb_event_t</type>
          <declname>event</declname>
        </param>
        <param>
          <type>esp_gatt_if_t</type>
          <declname>gatts_if</declname>
        </param>
        <param>
          <type>esp_ble_gatts_cb_param_t *</type>
          <declname>param</declname>
        </param>
        <briefdescription>
<para>为IO_CTRL_SERVICE配置事件处理提供的回调函数，由gatts_event_handler调度 </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>event</parametername>
</parameternamelist>
<parameterdescription>
<para>回调触发事件类型 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>gatts_if</parametername>
</parameternamelist>
<parameterdescription>
<para>GATT服务器访问接口 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>回调触发的参数 </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="613" column="13" bodyfile="main/sevetest30_BWEDA.c" bodystart="613" bodyend="762" declfile="main/sevetest30_BWEDA.c" declline="98" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1af4165e8b4c92675941e0c4a497421ac6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void MEDIA_CTRL_SERVICE_profile_handler</definition>
        <argsstring>(esp_gatts_cb_event_t event, esp_gatt_if_t gatts_if, esp_ble_gatts_cb_param_t *param)</argsstring>
        <name>MEDIA_CTRL_SERVICE_profile_handler</name>
        <param>
          <type>esp_gatts_cb_event_t</type>
          <declname>event</declname>
        </param>
        <param>
          <type>esp_gatt_if_t</type>
          <declname>gatts_if</declname>
        </param>
        <param>
          <type>esp_ble_gatts_cb_param_t *</type>
          <declname>param</declname>
        </param>
        <briefdescription>
<para>为MEDIA_CTRL_SERVICE配置事件处理提供的回调函数，由gatts_event_handler调度 </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>event</parametername>
</parameternamelist>
<parameterdescription>
<para>回调触发事件类型 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>gatts_if</parametername>
</parameternamelist>
<parameterdescription>
<para>GATT服务器访问接口 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>回调触发的参数 </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="768" column="13" bodyfile="main/sevetest30_BWEDA.c" bodystart="768" bodyend="955" declfile="main/sevetest30_BWEDA.c" declline="99" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1aaa057b814e8346f9a1057f9b719a4315" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void prepare_write_event</definition>
        <argsstring>(esp_gatt_if_t gatts_if, prepare_type_env_t *prepare_write_env, esp_ble_gatts_cb_param_t *param)</argsstring>
        <name>prepare_write_event</name>
        <param>
          <type>esp_gatt_if_t</type>
          <declname>gatts_if</declname>
        </param>
        <param>
          <type><ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref> *</type>
          <declname>prepare_write_env</declname>
        </param>
        <param>
          <type>esp_ble_gatts_cb_param_t *</type>
          <declname>param</declname>
        </param>
        <briefdescription>
<para>准备写入 事件，在回调函数中使用，为写操作缓存数据 </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>gatts_if</parametername>
</parameternamelist>
<parameterdescription>
<para>gatts接口类型 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prepare_write_env</parametername>
</parameternamelist>
<parameterdescription>
<para>准备写入配置 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>回调参数 </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="336" column="6" bodyfile="main/sevetest30_BWEDA.c" bodystart="336" bodyend="410"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1a20fb32742591c32ffaa8689c7d39ba24" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void execute_write_event</definition>
        <argsstring>(prepare_type_env_t *prepare_write_env, esp_ble_gatts_cb_param_t *param)</argsstring>
        <name>execute_write_event</name>
        <param>
          <type><ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref> *</type>
          <declname>prepare_write_env</declname>
        </param>
        <param>
          <type>esp_ble_gatts_cb_param_t *</type>
          <declname>param</declname>
        </param>
        <briefdescription>
<para>执行写入 事件，在回调函数中使用，为写操作判断是否执行 </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>prepare_write_env</parametername>
</parameternamelist>
<parameterdescription>
<para>准备写入配置 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>回调参数 </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="415" column="6" bodyfile="main/sevetest30_BWEDA.c" bodystart="415" bodyend="438"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1a50ba83bf77cdec4ac247bf44f357f310" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gap_event_handler</definition>
        <argsstring>(esp_gap_ble_cb_event_t event, esp_ble_gap_cb_param_t *param)</argsstring>
        <name>gap_event_handler</name>
        <param>
          <type>esp_gap_ble_cb_event_t</type>
          <declname>event</declname>
        </param>
        <param>
          <type>esp_ble_gap_cb_param_t *</type>
          <declname>param</declname>
        </param>
        <briefdescription>
<para>gap相关事件处理回调函数,GAP与广播活动相关，一般无需个性化的修改 </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>event</parametername>
</parameternamelist>
<parameterdescription>
<para>回调事件 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>回调参数 </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="443" column="13" bodyfile="main/sevetest30_BWEDA.c" bodystart="443" bodyend="505"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1aae8ed4e25351ba801179f79d655923ab" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gatts_event_handler</definition>
        <argsstring>(esp_gatts_cb_event_t event, esp_gatt_if_t gatts_if, esp_ble_gatts_cb_param_t *param)</argsstring>
        <name>gatts_event_handler</name>
        <param>
          <type>esp_gatts_cb_event_t</type>
          <declname>event</declname>
        </param>
        <param>
          <type>esp_gatt_if_t</type>
          <declname>gatts_if</declname>
        </param>
        <param>
          <type>esp_ble_gatts_cb_param_t *</type>
          <declname>param</declname>
        </param>
        <briefdescription>
<para>gatt服务器相关事件处理回调函数 </para>
        </briefdescription>
        <detaileddescription>
<para>以下gatts_event_handler这个回调函数有多种写法，这里对以下讲解, 我们这里 一个服务对应了一个应用，每个应用对应不同 gatts_if接口 BLE刚刚启动时，应用没有分配接口，没有创建属性表，没有启动应用对应服务，但是应用配置回调是确定的,以下仅包含预调用活动 T1 - (第1次运行)被系统内部调用了 - 事件: ESP_GATTS_REG_EVT T2 - (第1次运行)开始 预调度 活动，(预调度是为了每个应用顺利地 创建属性表 启动应用对应服务) T3 - (第1次运行)调度 应用表第 0 个应用运行对应回调 创建属性表 T4 - (第1次运行)结束 T5 - (第2次运行)被系统内部调用了 - 事件：ESP_GATTS_CREAT_ATTR_TAB_EVT ,因为应用0创建属性表完成了 T6 - (第2次运行)调度 应用表第 0 个应用运行对应回调 报告创建结果并打开服务 T7 - (第2次运行)为第 0 个应用分配接口 T8 - (第2次运行)调用esp_ble_gatts_app_register希望系统创建应用1 T9 - (第2次运行)结束 T10 -(第3次运行)被系统内部调用了并且参数gatts_if更新了 - 事件: ESP_GATTS_REG_EVT,因为得到了创建应用的请求， T11 -(第3次运行)开始 预调度 活动 T12 -(第3次运行)调度 应用表第 1 个应用运行对应回调 创建属性表 T13 -(第3次运行)结束 T14 -(第4次运行)被系统内部调用了 - 事件：ESP_GATTS_CREAT_ATTR_TAB_EVT ,因为应用1创建属性表完成了 T15 -(第4次运行)调度 应用表第 1 个应用运行对应回调 报告创建结果并打开服务 T16 -(第4次运行)为第 1 个应用分配接口 T17 -(第4次运行)结束，但是没有调用esp_ble_gatts_app_register希望系统创建应用2，因为没有应用2 -&gt; 预调度 活动结束 Tn -(第n次运行)根据系统提供的gatts_if接口，运行特定的回调 <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>event</parametername>
</parameternamelist>
<parameterdescription>
<para>回调触发事件类型 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>gatts_if</parametername>
</parameternamelist>
<parameterdescription>
<para>GATT服务器访问接口 </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>param</parametername>
</parameternamelist>
<parameterdescription>
<para>回调触发的参数 </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="533" column="13" bodyfile="main/sevetest30_BWEDA.c" bodystart="533" bodyend="607"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1ab02c566320eb5bed70fe514db11915b8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>esp_err_t</type>
        <definition>esp_err_t bluetooth_connect</definition>
        <argsstring>()</argsstring>
        <name>bluetooth_connect</name>
        <briefdescription>
<para>通用蓝牙接入函数 </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>ESP_OK / ESP_FAIL </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="959" column="11" bodyfile="main/sevetest30_BWEDA.c" bodystart="959" bodyend="1037"/>
      </memberdef>
      <memberdef kind="function" id="sevetest30___b_w_e_d_a_8c_1a94cf65820705e7bcbf213cc8fd1f66d2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void sevetest30_ble_attr_value_push</definition>
        <argsstring>()</argsstring>
        <name>sevetest30_ble_attr_value_push</name>
        <briefdescription>
<para>进行一次蓝牙数据推送,如果notify或indicate机制启动，会直接向客户端推送更新的特征值，否则它将只保存在本地属性表中,推送工作实际发生在服务配置回调下,推送数据来源为board_ctrl.c申请的堆缓存board_ctrl_buf </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="main/sevetest30_BWEDA.c" line="1040" column="6" bodyfile="main/sevetest30_BWEDA.c" bodystart="1040" bodyend="1055"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>701Enti<sp/>MIT<sp/>License</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>©<sp/>2024<sp/>&lt;701Enti<sp/>organization&gt;</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>Permission<sp/>is<sp/>hereby<sp/>granted,<sp/>free<sp/>of<sp/>charge,<sp/>to<sp/>any<sp/>person<sp/>obtaining<sp/></highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>a<sp/>copy<sp/>of<sp/>this<sp/>software<sp/>and<sp/>associated<sp/>documentation<sp/>files<sp/>(the<sp/>“Software”),<sp/></highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/>to<sp/>deal<sp/>in<sp/>the<sp/>Software<sp/>without<sp/>restriction,<sp/>including<sp/>without<sp/>limitation<sp/></highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/>the<sp/>rights<sp/>to<sp/>use,<sp/>copy,<sp/>modify,<sp/>merge,<sp/>publish,<sp/>distribute,<sp/>sublicense,<sp/>and/or<sp/>sell<sp/>copies<sp/>of<sp/>the<sp/>Software,</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*<sp/>and<sp/>to<sp/>permit<sp/>persons<sp/>to<sp/>whom<sp/>the<sp/>Software<sp/>is<sp/>furnished<sp/>to<sp/>do<sp/>so,<sp/>subject<sp/>to<sp/>the<sp/>following<sp/>conditions:</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>The<sp/>above<sp/>copyright<sp/>notice<sp/>and<sp/>this<sp/>permission<sp/>notice<sp/>shall<sp/>be<sp/>included<sp/>in<sp/>all<sp/>copies<sp/>or<sp/>substantial<sp/>portions<sp/>of<sp/>the<sp/>Software.</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>THE<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>“AS<sp/>IS”,<sp/>WITHOUT<sp/>WARRANTY<sp/>OF<sp/>ANY<sp/>KIND,<sp/>EXPRESS<sp/>OR<sp/>IMPLIED,<sp/></highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>INCLUDING<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO<sp/>THE<sp/>WARRANTIES<sp/>OF<sp/>MERCHANTABILITY,<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>AND<sp/>NONINFRINGEMENT.<sp/></highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>AUTHORS<sp/>OR<sp/>COPYRIGHT<sp/>HOLDERS<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>CLAIM,<sp/>DAMAGES<sp/>OR<sp/>OTHER<sp/>LIABILITY,</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*<sp/>WHETHER<sp/>IN<sp/>AN<sp/>ACTION<sp/>OF<sp/>CONTRACT,<sp/>TORT<sp/>OR<sp/>OTHERWISE,<sp/>ARISING<sp/>FROM,</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/>*<sp/>OUT<sp/>OF<sp/>OR<sp/>IN<sp/>CONNECTION<sp/>WITH<sp/>THE<sp/>SOFTWARE<sp/>OR<sp/>THE<sp/>USE<sp/>OR<sp/>OTHER<sp/>DEALINGS<sp/>IN<sp/>THE<sp/>SOFTWARE.</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="comment">//<sp/>该文件归属701Enti组织，SEVETEST30开发团队应该提供责任性维护，包含一些sevetest30的<sp/><sp/>低功耗蓝牙BLE环境中<sp/><sp/>数据获取（BWEDA）以及其他设备的蓝牙交互活动</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">//<sp/>蓝牙配置使用了ESP-IDF官方例程并进行修改，ESP-IDF项目地址<sp/>https://github.com/espressif/esp-idf<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="comment">//<sp/>使用的例程地址<sp/>https://github.com/espressif/esp-idf/tree/release/v4.4/examples/bluetooth/bluedroid/ble/gatt_server_service_table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="comment">//<sp/>此处修改了<sp/>服务属性数据库<sp/>服务数量<sp/>以及<sp/>gatts_event_handler回调<sp/>根据某个成员的理解添加了中文注释<sp/>添加<sp/>外部源文件board_ctrl的控制数据联动<sp/>提供了蓝牙数据存储与全局控制API的对接思路</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="comment">//<sp/>如您发现一些问题，请及时联系我们，我们非常感谢您的支持</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="comment">//<sp/>敬告：有效的数据存储变量都封装在该库下，不需要在外部函数定义一个数据结构体缓存作为参数，直接读取公共变量，主要为了方便FreeRTOS的任务支持</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="comment">//<sp/>敬告：ESP32S3目前只支持BLE,不支持经典蓝牙的音频传输，这里没有音频通讯的功能</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="comment">//<sp/>敬告：蓝牙配置操作使用了ESP-IDF官方例程并进行修改，非常感谢</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="comment">//<sp/>SIG官方提供的包含外观特征值<sp/>UUID<sp/>等定义的文档链接(2.6.2节-外观特征值<sp/>3.4.2节-UUID)<sp/>https://www.bluetooth.com/specifications/assigned-numbers/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="comment">//<sp/>github:<sp/>https://github.com/701Enti</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="comment">//<sp/>bilibili:<sp/>701Enti</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="sevetest30___b_w_e_d_a_8h" kindref="compound">sevetest30_BWEDA.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="board__def_8h" kindref="compound">board_def.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="board__ctrl_8h" kindref="compound">board_ctrl.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;freertos/FreeRTOS.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;freertos/task.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;freertos/event_groups.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_system.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_log.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;nvs_flash.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_bt.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_gap_ble_api.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_gatts_api.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_bt_main.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;esp_gatt_common_api.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>ESP_APP_ID<sp/>0x55</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SVC_INST_ID<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>ADV_CONFIG_FLAG<sp/>(1<sp/>&lt;&lt;<sp/>0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SCAN_RSP_CONFIG_FLAG<sp/>(1<sp/>&lt;&lt;<sp/>1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>广播状态</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="comment">//<sp/>准备写入事件缓存类型</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62" refid="structprepare__type__env__t" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal">{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>*<ref refid="structprepare__type__env__t_1a86277091728e8864d48925ccb1dd55c8" kindref="member">prepare_buf</ref>;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structprepare__type__env__t_1a1e7990aa05a5d71f70d4c30f5fe2e83c" kindref="member">prepare_len</ref>;</highlight></codeline>
<codeline lineno="66"><highlight class="normal">}<sp/><ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref>;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="comment">//<sp/>GATT服务器用户配置存储类型</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69" refid="structgatts__profile__inst" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgatts__profile__inst" kindref="compound">gatts_profile_inst</ref></highlight></codeline>
<codeline lineno="70"><highlight class="normal">{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_gatts_cb_t<sp/><ref refid="structgatts__profile__inst_1a4c206066cbb81acef9918e84f0fbd6c4" kindref="member">gatts_cb</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>用于用户配置事件处理的回调函数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>gatts接口类型</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/><ref refid="structgatts__profile__inst_1a9ad98b3ef12c175e238b5ea7a0a72bc1" kindref="member">app_id</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>应用ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/><ref refid="structgatts__profile__inst_1a9cb9e05e2051e95647ab28c85d83e9c0" kindref="member">conn_id</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>连接ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/><ref refid="structgatts__profile__inst_1ae0e0dfde18dd6421f433a416ac16b32d" kindref="member">service_handle</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>指定的服务句柄</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_gatt_srvc_id_t<sp/><ref refid="structgatts__profile__inst_1aee371edec21d7ff7837535d6a5ac66ad" kindref="member">service_id</ref>;<sp/></highlight><highlight class="comment">//<sp/>指定的服务集合ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/><ref refid="structgatts__profile__inst_1a24a2a156265df785fbe124f390535706" kindref="member">char_handle</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>指定的特性句柄</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_bt_uuid_t<sp/><ref refid="structgatts__profile__inst_1a804b494ce49c3a89dd02650b14fe9136" kindref="member">char_uuid</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>指定的特性UUID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_gatt_perm_t<sp/><ref refid="structgatts__profile__inst_1afdc86e882144c2c17a39178766bf0db6" kindref="member">perm</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_gatt_char_prop_t<sp/><ref refid="structgatts__profile__inst_1a3b2cb211709c89a53fecbfef7f57916f" kindref="member">property</ref>;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/><ref refid="structgatts__profile__inst_1ab80bf86db2fd74ef5cf1b1dbd7d2c3c1" kindref="member">descr_handle</ref>;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_bt_uuid_t<sp/><ref refid="structgatts__profile__inst_1ab46b4ecee282926c81162c5b781ffbfc" kindref="member">descr_uuid</ref>;</highlight></codeline>
<codeline lineno="83"><highlight class="normal">};</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight><highlight class="comment">//<sp/>应用表APP注册顺序</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal">{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9aafaeb90cd4b310beb1e5f2870e03a773" kindref="member">IO_CTRL_PROFILE_APP</ref><sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a2f711ca81ede538ca558e5addcb2b190" kindref="member">MEDIA_CTRL_PROFILE_APP</ref>,</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a0456ce963a48c5e10132778db64ceb77" kindref="member">PROFILE_NUM</ref>,</highlight></codeline>
<codeline lineno="96"><highlight class="normal">};</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ab6595366a5a836bb0ad25fe855930620" kindref="member">IO_CTRL_SERVICE_profile_handler</ref>(esp_gatts_cb_event_t<sp/>event,<sp/>esp_gatt_if_t<sp/>gatts_if,<sp/>esp_ble_gatts_cb_param_t<sp/>*param);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1af4165e8b4c92675941e0c4a497421ac6" kindref="member">MEDIA_CTRL_SERVICE_profile_handler</ref>(esp_gatts_cb_event_t<sp/>event,<sp/>esp_gatt_if_t<sp/>gatts_if,<sp/>esp_ble_gatts_cb_param_t<sp/>*param);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight><highlight class="comment">//<sp/>应用表</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno=CONFIG_WIFI_SSID><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structgatts__profile__inst" kindref="compound">gatts_profile_inst</ref><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a0456ce963a48c5e10132778db64ceb77" kindref="member">PROFILE_NUM</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9aafaeb90cd4b310beb1e5f2870e03a773" kindref="member">IO_CTRL_PROFILE_APP</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.gatts_cb<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ab6595366a5a836bb0ad25fe855930620" kindref="member">IO_CTRL_SERVICE_profile_handler</ref>,</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.gatts_if<sp/>=<sp/>ESP_GATT_IF_NONE,</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a2f711ca81ede538ca558e5addcb2b190" kindref="member">MEDIA_CTRL_PROFILE_APP</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.gatts_cb<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1af4165e8b4c92675941e0c4a497421ac6" kindref="member">MEDIA_CTRL_SERVICE_profile_handler</ref>,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.gatts_if<sp/>=<sp/>ESP_GATT_IF_NONE,</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal">};</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务UUID,重复可能性较低，这里所有服务UUID统一用SIG规定的</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SERV_UUID_AUTOMATION_IO<sp/>0x1815<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>自动IO控制</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>SERV_UUID_GENERIC_MEDIA_CONTROL<sp/>0x1849<sp/></highlight><highlight class="comment">//<sp/>通用媒体控制</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="comment">//<sp/>特征UUID，因为可能同一个服务有多个相同属性特征，所以一般使用下面的自定义特征UUID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>CHAR_UUID_ACS_DATA_OUT_NOTIFY<sp/>0x2B31</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>CHAR_UUID_ACS_DATA_OUT_INDICATE<sp/>0x2B32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal">{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba93e10c5f69a18fb3240d805283f5b68c" kindref="member">SE30_CHAR_UUID_MIN</ref><sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba914d77909c78391e605003659de4a8fb" kindref="member">SE30_CHAR_UUID_1</ref>,</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba9baa035d356da7a185d43885973f9b33" kindref="member">SE30_CHAR_UUID_2</ref>,</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbae0de20e9e0006b6006945833f53b7113" kindref="member">SE30_CHAR_UUID_3</ref>,</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbac0326642c9fc4699da38d35892e49015" kindref="member">SE30_CHAR_UUID_4</ref>,</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba22301769dbe723670bde7bc799c38035" kindref="member">SE30_CHAR_UUID_5</ref>,</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba053738fee9e3ae90c29e02d7d7b7bfb1" kindref="member">SE30_CHAR_UUID_6</ref>,</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba6468eaeb48517fba6d8b0e938ab391e2" kindref="member">SE30_CHAR_UUID_7</ref>,</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba7d647484e9305152a0bbb85645c1852a" kindref="member">SE30_CHAR_UUID_8</ref>,</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbaee7ba995368f991a3b39a25b9b49b2b6" kindref="member">SE30_CHAR_UUID_9</ref>,</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba0876efd58b493213d65fb314ed152303" kindref="member">SE30_CHAR_UUID_10</ref>,</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbacdf44f5d171961e0af372063d876ba50" kindref="member">SE30_CHAR_UUID_11</ref>,</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba5c1a8ca65052cf9d1e21fcb3973f1d29" kindref="member">SE30_CHAR_UUID_12</ref>,</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbaf057a8cd3b9221682e29592ecd731f93" kindref="member">SE30_CHAR_UUID_13</ref>,</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba931b6859e83535fc5b37123210d846f0" kindref="member">SE30_CHAR_UUID_14</ref>,</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba70dee06ffa91b209e45e6690f92a2732" kindref="member">SE30_CHAR_UUID_15</ref>,</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba88b10ca8827b7ad7c17b9a340da48068" kindref="member">SE30_CHAR_UUID_MAX</ref>,</highlight></codeline>
<codeline lineno="147"><highlight class="normal">};</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight><highlight class="comment">//<sp/>公共缓存</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a906dfab674e5b65aa8b2020087e66c50" kindref="member">primary_service_uuid</ref><sp/>=<sp/>ESP_GATT_UUID_PRI_SERVICE;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a8dbb0e6a5920e94c0473e375558f7265" kindref="member">character_declaration_uuid</ref><sp/>=<sp/>ESP_GATT_UUID_CHAR_DECLARE;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1add4f5ff5fc585021ed07e339b0ef936f" kindref="member">character_client_config_uuid</ref><sp/>=<sp/>ESP_GATT_UUID_CHAR_CLIENT_CONFIG;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight><highlight class="comment">//<sp/>static<sp/>const<sp/>uint16_t<sp/>character_client_config_uuid<sp/>=<sp/>ESP_GATT_UUID_CHAR_CLIENT_CONFIG;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight><highlight class="comment">//<sp/>static<sp/>const<sp/>uint8_t<sp/>char_prop_read<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><sp/>ESP_GATT_CHAR_PROP_BIT_READ;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight><highlight class="comment">//<sp/>static<sp/>const<sp/>uint8_t<sp/>char_prop_write<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>ESP_GATT_CHAR_PROP_BIT_WRITE;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ad1d27d47c7fd785c27d90f977ceb3c9e" kindref="member">char_prop_read_write_notify</ref><sp/>=<sp/>ESP_GATT_CHAR_PROP_BIT_WRITE<sp/>|<sp/>ESP_GATT_CHAR_PROP_BIT_READ<sp/>|<sp/>ESP_GATT_CHAR_PROP_BIT_NOTIFY;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight><highlight class="comment">//<sp/>static<sp/>const<sp/>uint8_t<sp/>char_prop_read_write_notify_indicate<sp/>=<sp/>ESP_GATT_CHAR_PROP_BIT_WRITE<sp/>|<sp/>ESP_GATT_CHAR_PROP_BIT_READ<sp/>|<sp/>ESP_GATT_CHAR_PROP_BIT_NOTIFY<sp/>|<sp/>ESP_GATT_CHAR_PROP_BIT_INDICATE;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight><highlight class="comment">/*******************************************************自动IO服务************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight><highlight class="comment">//<sp/>16bits服务UUID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>BLE_SERVICE_IO_CTRL_UUID16<sp/>(SERV_UUID_AUTOMATION_IO)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务元素列表</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal">{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45a9aaa6fd7c050fa923bc14e46a58c19f7" kindref="member">IO_CTRL_SERVICE</ref>,<sp/></highlight><highlight class="comment">//<sp/>服务</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45adda65ba93d55b1269b7956ef865c97a3" kindref="member">IO_CTRL_EN_DISPLAY_CHAR</ref>,</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45ac11ab5acad6a1c3bfe54518e2913fd22" kindref="member">IO_CTRL_EN_DISPLAY_VALUE</ref>,</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45aea0f9735f12f080d283855cf9b9395be" kindref="member">IO_CTRL_IDX_NB</ref>,</highlight></codeline>
<codeline lineno="174"><highlight class="normal">};</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务句柄列表</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal">uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a6216759639ba936214a16ceed081db9f" kindref="member">io_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45aea0f9735f12f080d283855cf9b9395be" kindref="member">IO_CTRL_IDX_NB</ref>];</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务相关数据缓存</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a2604258a5b8872487a419c42e2bda5f8" kindref="member">io_ctrl_service_uuid</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a8772640cb9ab74e3aad846d657bc3419" kindref="member">BLE_SERVICE_IO_CTRL_UUID16</ref>;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1af1c49502efc8ab4a26414ee488137b22" kindref="member">io_ctrl_uuid_buf_1</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba914d77909c78391e605003659de4a8fb" kindref="member">SE30_CHAR_UUID_1</ref>;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3d4804e1bd925789002f9d43979fd091" kindref="member">io_ctrl_display_en</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务数据库，可以包含BLE中一个服务和n个特性的属性数据以及响应模式，注意，这里的属性不是指代BLE中特征值的读写权限属性，而是所有描述属性,包括服务本身也是有属性配置的</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight><highlight class="comment">//<sp/>数据库使用结构体数组加枚举类型索引，数组每个单元由<sp/>响应模式控制类型<sp/>和<sp/>属性描述结构体<sp/>构成，</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight><highlight class="comment">//<sp/>属性描述结构体包含属性的<sp/>UUID长度<sp/>+指向UUID的指针(uint8_t<sp/>*)<sp/>+<sp/>属性许可<sp/>+<sp/><sp/>数据值最大大小<sp/>+<sp/><sp/>数据值实际大小<sp/>+<sp/>指向数据值的指针(uint8_t<sp/>*)构成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight><highlight class="comment">//(UUID<sp/>数据值单位<sp/>都需要遵循<sp/>SIG<sp/>的定义)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>esp_gatts_attr_db_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a368f93fc68770506027b0b81b36414c7" kindref="member">io_ctrl_gatt_database</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45aea0f9735f12f080d283855cf9b9395be" kindref="member">IO_CTRL_IDX_NB</ref>]<sp/>=</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45a9aaa6fd7c050fa923bc14e46a58c19f7" kindref="member">IO_CTRL_SERVICE</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a906dfab674e5b65aa8b2020087e66c50" kindref="member">primary_service_uuid</ref>,</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ,</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint16_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="sevetest30___b_w_e_d_a_8c_1a2604258a5b8872487a419c42e2bda5f8" kindref="member">io_ctrl_service_uuid</ref>),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a2604258a5b8872487a419c42e2bda5f8" kindref="member">io_ctrl_service_uuid</ref>}},</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45adda65ba93d55b1269b7956ef865c97a3" kindref="member">IO_CTRL_EN_DISPLAY_CHAR</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},<sp/>{ESP_UUID_LEN_16,<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a8dbb0e6a5920e94c0473e375558f7265" kindref="member">character_declaration_uuid</ref>,<sp/>ESP_GATT_PERM_READ,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1ad1d27d47c7fd785c27d90f977ceb3c9e" kindref="member">char_prop_read_write_notify</ref>}},</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45ac11ab5acad6a1c3bfe54518e2913fd22" kindref="member">IO_CTRL_EN_DISPLAY_VALUE</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},<sp/>{ESP_UUID_LEN_16,<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1af1c49502efc8ab4a26414ee488137b22" kindref="member">io_ctrl_uuid_buf_1</ref>,<sp/>ESP_GATT_PERM_READ<sp/>|<sp/>ESP_GATT_PERM_WRITE,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a3d4804e1bd925789002f9d43979fd091" kindref="member">io_ctrl_display_en</ref>}},</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal">};</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight><highlight class="comment">/**********************************************************************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight><highlight class="comment">/*******************************************************通用媒体控制服务************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight><highlight class="comment">//<sp/>16bits服务UUID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>BLE_SERVICE_MEDIA_CTRL_UUID16<sp/>SERV_UUID_GENERIC_MEDIA_CONTROL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务元素列表</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal">{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf5983682960bf9927095dcbc41fe8333" kindref="member">MEDIA_CTRL_SERVICE</ref>,<sp/></highlight><highlight class="comment">//<sp/>服务</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba4e620c32074a4fef90bc84a0ade3f371" kindref="member">MEDIA_CTRL_VOL_AMP_CHAR</ref>,<sp/><sp/></highlight><highlight class="comment">//<sp/>扬声器-功率放大器音量</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" kindref="member">MEDIA_CTRL_VOL_AMP_VALUE</ref>,<sp/></highlight><highlight class="comment">//<sp/>扬声器-功率放大器音量-值</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2470c90ab387e9b75c7d5fb01c868a16" kindref="member">MEDIA_CTRL_VOL_AMP_CFG</ref>,</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaa503893e057d12c77084e1e4b948586b" kindref="member">MEDIA_CTRL_MUTE_AMP_CHAR</ref>,<sp/><sp/></highlight><highlight class="comment">//<sp/>扬声器-功率放大器音量</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" kindref="member">MEDIA_CTRL_MUTE_AMP_VALUE</ref>,<sp/></highlight><highlight class="comment">//<sp/>扬声器-功率放大器音量-值</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba7ada8457ec1fdcb054b2599468e58f41" kindref="member">MEDIA_CTRL_MUTE_AMP_CFG</ref>,</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbae8432910de733803f8c482c3f39573fe" kindref="member">MEDIA_CTRL_IDX_NB</ref>,</highlight></codeline>
<codeline lineno="223"><highlight class="normal">};</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务句柄列表</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal">uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbae8432910de733803f8c482c3f39573fe" kindref="member">MEDIA_CTRL_IDX_NB</ref>];</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务相关数据缓存</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aa6f078e79fa66dc43a987b567c920ef6" kindref="member">media_ctrl_service_uuid</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a9a00abf5ebe37d88d7a548990c08f33b" kindref="member">BLE_SERVICE_MEDIA_CTRL_UUID16</ref>;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3d368b240335e7e8eb7435724ac96f87" kindref="member">media_ctrl_uuid_buf_1</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcba9baa035d356da7a185d43885973f9b33" kindref="member">SE30_CHAR_UUID_2</ref>;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a6e7e35d5a2a04c3bd106c60beab9e905" kindref="member">media_ctrl_uuid_buf_2</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a40c59e17cd11d6fb006e38a7118bbbcbae0de20e9e0006b6006945833f53b7113" kindref="member">SE30_CHAR_UUID_3</ref>;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref><sp/>=<sp/>0x00;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" kindref="member">media_ctrl_amp_mute_buf</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>=<sp/>0x0000;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint16_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>=<sp/>0x0000;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight><highlight class="comment">//<sp/>服务数据库，可以包含BLE中一个服务和n个特性的属性数据以及响应模式，注意，这里的属性不是指代BLE中特征值的读写权限属性，而是所有描述属性,包括服务本身也是有属性配置的</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight><highlight class="comment">//<sp/>数据库使用结构体数组加枚举类型索引，数组每个单元由<sp/>响应模式控制类型<sp/>和<sp/>属性描述结构体<sp/>构成，</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight><highlight class="comment">//<sp/>属性描述结构体包含服务或特性的<sp/>UUID长度<sp/>+指向UUID的指针(uint8_t<sp/>*)<sp/>+<sp/>属性许可<sp/>+<sp/><sp/>数据值最大大小<sp/>+<sp/><sp/>数据值实际大小<sp/>+<sp/>指向数据值的指针(uint8_t<sp/>*)构成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight><highlight class="comment">//(UUID<sp/>数据值单位<sp/>都需要遵循<sp/>SIG<sp/>的定义)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>esp_gatts_attr_db_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1abc2f05fededbd7b5dd6eecb033fe99ff" kindref="member">media_ctrl_gatt_database</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbae8432910de733803f8c482c3f39573fe" kindref="member">MEDIA_CTRL_IDX_NB</ref>]<sp/>=</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf5983682960bf9927095dcbc41fe8333" kindref="member">MEDIA_CTRL_SERVICE</ref>]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a906dfab674e5b65aa8b2020087e66c50" kindref="member">primary_service_uuid</ref>,</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ,</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint16_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="sevetest30___b_w_e_d_a_8c_1aa6f078e79fa66dc43a987b567c920ef6" kindref="member">media_ctrl_service_uuid</ref>),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1aa6f078e79fa66dc43a987b567c920ef6" kindref="member">media_ctrl_service_uuid</ref>}},</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba4e620c32074a4fef90bc84a0ade3f371" kindref="member">MEDIA_CTRL_VOL_AMP_CHAR</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a8dbb0e6a5920e94c0473e375558f7265" kindref="member">character_declaration_uuid</ref>,</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ,</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1ad1d27d47c7fd785c27d90f977ceb3c9e" kindref="member">char_prop_read_write_notify</ref>}},</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" kindref="member">MEDIA_CTRL_VOL_AMP_VALUE</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a3d368b240335e7e8eb7435724ac96f87" kindref="member">media_ctrl_uuid_buf_1</ref>,</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ<sp/>|<sp/>ESP_GATT_PERM_WRITE,</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref>}},</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2470c90ab387e9b75c7d5fb01c868a16" kindref="member">MEDIA_CTRL_VOL_AMP_CFG</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1add4f5ff5fc585021ed07e339b0ef936f" kindref="member">character_client_config_uuid</ref>,</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ<sp/>|<sp/>ESP_GATT_PERM_WRITE,</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint16_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint16_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref>}},</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaa503893e057d12c77084e1e4b948586b" kindref="member">MEDIA_CTRL_MUTE_AMP_CHAR</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a8dbb0e6a5920e94c0473e375558f7265" kindref="member">character_declaration_uuid</ref>,</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ,</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1ad1d27d47c7fd785c27d90f977ceb3c9e" kindref="member">char_prop_read_write_notify</ref>}},</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" kindref="member">MEDIA_CTRL_MUTE_AMP_VALUE</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a6e7e35d5a2a04c3bd106c60beab9e905" kindref="member">media_ctrl_uuid_buf_2</ref>,</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ<sp/>|<sp/>ESP_GATT_PERM_WRITE,</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" kindref="member">media_ctrl_amp_mute_buf</ref>}},</highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba7ada8457ec1fdcb054b2599468e58f41" kindref="member">MEDIA_CTRL_MUTE_AMP_CFG</ref>]<sp/>=<sp/>{{ESP_GATT_AUTO_RSP},</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{ESP_UUID_LEN_16,(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1add4f5ff5fc585021ed07e339b0ef936f" kindref="member">character_client_config_uuid</ref>,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_GATT_PERM_READ<sp/>|<sp/>ESP_GATT_PERM_WRITE,</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint16_t),<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint16_t),<sp/>(uint8_t<sp/>*)&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref>}}};</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight><highlight class="comment">/**********************************************************************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight><highlight class="comment">//<sp/>广播传输的服务UUID，BLE可以设置多个服务，然而，在广播时只传输一个关键服务的UUID,方便其他设备快速了解功能，这个UUID是否存在不影响基本功能</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint8_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4c742bc6850d9fb422de10f998f727ac" kindref="member">adv_key_service_uuid</ref>[ESP_UUID_LEN_128]<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1aef76149f1648102db9e3eadf4f8edc13" kindref="member">BLE_SERVICE_UUID_BASE</ref>(<ref refid="sevetest30___b_w_e_d_a_8c_1a8772640cb9ab74e3aad846d657bc3419" kindref="member">BLE_SERVICE_IO_CTRL_UUID16</ref>);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight><highlight class="comment">//<sp/>蓝牙广播数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>esp_ble_adv_data_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4f6bab3fd366271d5588e91a6420e0b0" kindref="member">adv_data</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>.set_scan_rsp<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>以下内容是否为扫描响应配置</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>.include_name<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>是否在广播数据中添加设备名称</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/>.include_txpower<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>是否在广播数据中添加发射功率</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>.min_interval<sp/>=<sp/>0x0006,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>从设备连接窗口最小间隔数,最小间隔时间为min_interval<sp/>*<sp/>1.25毫秒</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>.max_interval<sp/>=<sp/>0x0010,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>从设备连接窗口最大间隔数,最大间隔时间为max_interval<sp/>*<sp/>1.25毫秒</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/>.appearance<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a2af4be4a9bdf7f8aa7c4e5decbc725f5" kindref="member">BLE_DEVICE_APPEARANCE_VALUE</ref>,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>蓝牙设备外观特征值，描述产品基本类型</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>.manufacturer_len<sp/>=<sp/>0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>制造商数据长度</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>.p_manufacturer_data<sp/>=<sp/>NULL,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>导入制造商数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>.service_data_len<sp/>=<sp/>0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>服务数据长度</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>.p_service_data<sp/>=<sp/>NULL,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>导入服务数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/>.service_uuid_len<sp/>=<sp/>0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>关键服务UUID长度，BLE可以设置多个服务，然而，在广播时只传输一个关键服务的UUID,方便其他设备快速了解功能，这个UUID是否存在不影响基本功能<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>关键服务UUID长度，BLE可以设置多个服务，然而，在广播时只传输一个关键服务的UUID,方便其他设备快速了解功能，这个UUID是否存在不影响基本功能</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/>.p_service_uuid<sp/>=<sp/>NULL,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>导入关键服务UUID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>.flag<sp/>=<sp/>(ESP_BLE_ADV_FLAG_GEN_DISC<sp/>|<sp/>ESP_BLE_ADV_FLAG_BREDR_NOT_SPT),<sp/></highlight><highlight class="comment">//<sp/>广播模式标识</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal">};</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight><highlight class="comment">//<sp/>扫描响应数据,广播启动后，当ESP32接收到其他设备扫描请求，回复扫描响应，这往往是广播数据的补充，使用了与广播数据一样的数据结构处理</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>esp_ble_adv_data_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1af5fb860dba0137132e1b5d606e56beee" kindref="member">scan_rsp_data</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/>.set_scan_rsp<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>以下内容是否为扫描响应配置</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>.include_name<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>是否在扫描响应中添加设备名称</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>.include_txpower<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/></highlight><highlight class="comment">//<sp/>是否在扫描响应中添加发射功率</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>.min_interval<sp/>=<sp/>0x0006,</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>.max_interval<sp/>=<sp/>0x0010,</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>.appearance<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a2af4be4a9bdf7f8aa7c4e5decbc725f5" kindref="member">BLE_DEVICE_APPEARANCE_VALUE</ref>,<sp/></highlight><highlight class="comment">//<sp/>蓝牙设备外观特征值，描述产品基本类型</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/>.manufacturer_len<sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>.p_manufacturer_data<sp/>=<sp/>NULL,</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>.service_data_len<sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>.p_service_data<sp/>=<sp/>NULL,</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>.service_uuid_len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="sevetest30___b_w_e_d_a_8c_1a4c742bc6850d9fb422de10f998f727ac" kindref="member">adv_key_service_uuid</ref>),<sp/></highlight><highlight class="comment">//<sp/>关键服务UUID长度，BLE可以设置多个服务，然而，在广播时只传输一个关键服务的UUID,方便其他设备快速了解功能，这个UUID是否存在不影响基本功能</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/>.p_service_uuid<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4c742bc6850d9fb422de10f998f727ac" kindref="member">adv_key_service_uuid</ref>,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>导入关键服务UUID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>.flag<sp/>=<sp/>(ESP_BLE_ADV_FLAG_GEN_DISC<sp/>|<sp/>ESP_BLE_ADV_FLAG_BREDR_NOT_SPT),</highlight></codeline>
<codeline lineno="320"><highlight class="normal">};</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight><highlight class="comment">//<sp/>蓝牙广播参数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>esp_ble_adv_params_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1abee55223218f5469c9399d8b5503663e" kindref="member">adv_params</ref><sp/>=<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>.adv_int_min<sp/>=<sp/>0x20,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播最小间隔数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>.adv_int_max<sp/>=<sp/>0x40,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播最大间隔数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>.adv_type<sp/>=<sp/>ADV_TYPE_IND,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播报文类型为<sp/>可连接非定向<sp/>通用广播指示</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>.own_addr_type<sp/>=<sp/>BLE_ADDR_TYPE_PUBLIC,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播地址类型为公共地址<sp/>非随机地址，合法设备的公共地址独一无二</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>.channel_map<sp/>=<sp/>ADV_CHNL_ALL,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>.adv_filter_policy<sp/>=<sp/>ADV_FILTER_ALLOW_SCAN_ANY_CON_ANY,<sp/></highlight><highlight class="comment">//<sp/>允许任何设备扫描和连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal">};</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aaa057b814e8346f9a1057f9b719a4315" kindref="member">prepare_write_event</ref>(esp_gatt_if_t<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/><ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref><sp/>*<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>,<sp/>esp_ble_gatts_cb_param_t<sp/>*param)</highlight></codeline>
<codeline lineno="337"><highlight class="normal">{</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;prepare_write_event&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;准备写入,数据长度<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>param-&gt;write.len);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_gatt_status_t<sp/>status<sp/>=<sp/>ESP_GATT_OK;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>如果缓存区没有被申请，为写入数据申请缓存</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf)</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf<sp/>=<sp/>(uint8_t<sp/>*)malloc(<ref refid="sevetest30___b_w_e_d_a_8h_1a9c1db363d0927b26137fab5970d216d6" kindref="member">BLE_PREPARE_BUF_SIZE_MAX</ref><sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t));</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf)</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;申请prepare_buf缓存时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status<sp/>=<sp/>ESP_GATT_NO_RESOURCES;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>如果缓存区已经被申请，判断写入状态</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;write.offset<sp/>&gt;<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a9c1db363d0927b26137fab5970d216d6" kindref="member">BLE_PREPARE_BUF_SIZE_MAX</ref>)</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status<sp/>=<sp/>ESP_GATT_INVALID_OFFSET;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((param-&gt;write.offset<sp/>+<sp/>param-&gt;write.len)<sp/>&gt;<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a9c1db363d0927b26137fab5970d216d6" kindref="member">BLE_PREPARE_BUF_SIZE_MAX</ref>)</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status<sp/>=<sp/>ESP_GATT_INVALID_ATTR_LEN;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>存在响应需求，传输响应</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;write.need_rsp)</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>申请内存保存gatt参数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_gatt_rsp_t<sp/>*gatt_rsp<sp/>=<sp/>(esp_gatt_rsp_t<sp/>*)malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(esp_gatt_rsp_t));</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gatt_rsp)</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gatt_rsp-&gt;attr_value.handle<sp/>=<sp/>param-&gt;write.handle;<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>写入句柄</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gatt_rsp-&gt;attr_value.len<sp/>=<sp/>param-&gt;write.len;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>写入长度</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gatt_rsp-&gt;attr_value.offset<sp/>=<sp/>param-&gt;write.offset;<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>写入偏移</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gatt_rsp-&gt;attr_value.auth_req<sp/>=<sp/>ESP_GATT_AUTH_REQ_NONE;<sp/></highlight><highlight class="comment">//<sp/>身份验证</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>把参数中的值写入响应数据中</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(gatt_rsp-&gt;attr_value.value,<sp/>param-&gt;write.value,<sp/>param-&gt;write.len);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>传输响应</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_err_t<sp/>response_err<sp/>=<sp/>esp_ble_gatts_send_response(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>param-&gt;write.conn_id,<sp/>param-&gt;write.trans_id,<sp/>status,<sp/>gatt_rsp);</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(response_err<sp/>!=<sp/>ESP_OK)</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;传输响应时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(gatt_rsp);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;申请gatt_rsp缓存时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="399"><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(status<sp/>!=<sp/>ESP_GATT_OK)</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备缓存资源，处理响应需求完成，映射写入的值</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf<sp/>+<sp/>param-&gt;write.offset,<sp/>param-&gt;write.value,<sp/>param-&gt;write.len);</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>已准备长度累加</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_len<sp/>+=<sp/>param-&gt;write.len;</highlight></codeline>
<codeline lineno="410"><highlight class="normal">}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a20fb32742591c32ffaa8689c7d39ba24" kindref="member">execute_write_event</ref>(<ref refid="structprepare__type__env__t" kindref="compound">prepare_type_env_t</ref><sp/>*<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>,<sp/>esp_ble_gatts_cb_param_t<sp/>*param)</highlight></codeline>
<codeline lineno="416"><highlight class="normal">{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;execute_write_event&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>如果写入标识为执行状态，并且准备写入缓存非空</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;exec_write.exec_write_flag<sp/>==<sp/>ESP_GATT_PREP_WRITE_EXEC<sp/>&amp;&amp;<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf)</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_log_buffer_hex(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_len);<sp/></highlight><highlight class="comment">//<sp/>以16进制打印写入内容</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;写入取消&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>清理准备写入缓存</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf)</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf);</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_buf<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>-&gt;prepare_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="438"><highlight class="normal">}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a50ba83bf77cdec4ac247bf44f357f310" kindref="member">gap_event_handler</ref>(esp_gap_ble_cb_event_t<sp/>event,<sp/>esp_ble_gap_cb_param_t<sp/>*param)</highlight></codeline>
<codeline lineno="444"><highlight class="normal">{</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;gap_event_handler&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(event)</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播数据设置完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GAP_BLE_ADV_DATA_SET_COMPLETE_EVT:</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>&amp;=<sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a5d2f5677517e7c8fd4ee8e2287ebec3b" kindref="member">~ADV_CONFIG_FLAG</ref>);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gap_start_advertising(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1abee55223218f5469c9399d8b5503663e" kindref="member">adv_params</ref>);<sp/></highlight><highlight class="comment">//<sp/>设置正常，广播启动</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>扫描响应数据设置完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GAP_BLE_SCAN_RSP_DATA_SET_COMPLETE_EVT:</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>&amp;=<sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1ad92fd6350531e23c955c71626296406c" kindref="member">~SCAN_RSP_CONFIG_FLAG</ref>);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gap_start_advertising(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1abee55223218f5469c9399d8b5503663e" kindref="member">adv_params</ref>);<sp/></highlight><highlight class="comment">//<sp/>设置正常，发送响应</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播启动工作结束</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GAP_BLE_ADV_START_COMPLETE_EVT:</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;adv_start_cmpl.status<sp/>!=<sp/>ESP_BT_STATUS_SUCCESS)</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;启动广播时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;启动广播成功&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>广播终止工作结束</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GAP_BLE_ADV_STOP_COMPLETE_EVT:</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;adv_stop_cmpl.status<sp/>!=<sp/>ESP_BT_STATUS_SUCCESS)</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;终止广播时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;终止广播成功&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>上传连接参数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GAP_BLE_UPDATE_CONN_PARAMS_EVT:</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;上传连接参数<sp/>状态-%d<sp/>最小连接间隔-%d<sp/>最大连接间隔-%d<sp/>连接间隔-%d<sp/>从机延迟-%d<sp/>超时时间-%d&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>param-&gt;update_conn_params.status,</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>param-&gt;update_conn_params.min_int,</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>param-&gt;update_conn_params.max_int,</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>param-&gt;update_conn_params.conn_int,</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>param-&gt;update_conn_params.latency,</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>param-&gt;update_conn_params.timeout);</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGW(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;其他事件触发了,但是处理方式没有被设置&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="505"><highlight class="normal">}</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aae8ed4e25351ba801179f79d655923ab" kindref="member">gatts_event_handler</ref>(esp_gatts_cb_event_t<sp/>event,<sp/>esp_gatt_if_t<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>esp_ble_gatts_cb_param_t<sp/>*param)</highlight></codeline>
<codeline lineno="534"><highlight class="normal">{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;gatts_event_handler&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(event)</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_REG_EVT:</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;reg.status<sp/>==<sp/>ESP_GATT_OK)</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>引导GAP进行活动,只进行一次</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(idx<sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a0456ce963a48c5e10132778db64ceb77" kindref="member">PROFILE_NUM</ref><sp/>-<sp/>1)</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gap_set_device_name(<ref refid="sevetest30___b_w_e_d_a_8h_1a3b349281f66852ccb8ac192b907fa5ed" kindref="member">BLE_DEVICE_NAME</ref>))</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;设置设备名称时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gap_config_adv_data(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a4f6bab3fd366271d5588e91a6420e0b0" kindref="member">adv_data</ref>))</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;配置广播时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>|=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5d2f5677517e7c8fd4ee8e2287ebec3b" kindref="member">ADV_CONFIG_FLAG</ref>;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gap_config_adv_data(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1af5fb860dba0137132e1b5d606e56beee" kindref="member">scan_rsp_data</ref>))</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;配置扫描响应时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a71ad7874889a444d2a92eddd658d6b60" kindref="member">adv_config_done</ref><sp/>|=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ad92fd6350531e23c955c71626296406c" kindref="member">SCAN_RSP_CONFIG_FLAG</ref>;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[idx].<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref><sp/>==<sp/>ESP_GATT_IF_NONE)</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[idx].gatts_cb(event,<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;存储应用时发现问题,<sp/>APP_ID<sp/>%04x,<sp/>状态<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>param-&gt;reg.app_id,<sp/>param-&gt;reg.status);</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CREAT_ATTR_TAB_EVT:</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>继续选定现在的应用，完成服务启动工作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[idx].gatts_cb(event,<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>分配接口</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[idx].gatts_if<sp/>=<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>引导下一个应用</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idx++;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(idx<sp/>&lt;<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a0456ce963a48c5e10132778db64ceb77" kindref="member">PROFILE_NUM</ref>)</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_app_register(idx);<sp/></highlight><highlight class="comment">//<sp/>注意，注册下一个应用时，系统会分配新的接口，下一个应用将占用这个接口</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_DISCONNECT_EVT:</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gap_start_advertising(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1abee55223218f5469c9399d8b5503663e" kindref="member">adv_params</ref>);<sp/></highlight><highlight class="comment">//<sp/>回到广播态</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="595"><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a77ce05aae30693f30a7c4e3951590cc9a0456ce963a48c5e10132778db64ceb77" kindref="member">PROFILE_NUM</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>每次gatt服务器回调触发，包含一个特定的gatts_if,不同应用对应不同gatts_if，所以会运行特定的应用回调，</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>在一个应用完成<sp/>预调度<sp/>后，将可以被这样自由地调用</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>应用APP_ID不处在默认时的ESP_GATT_IF_NONE时，表示完成<sp/>预调度</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref><sp/>!=<sp/>ESP_GATT_IF_NONE<sp/>&amp;&amp;<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[i].<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>)</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[i].<ref refid="structgatts__profile__inst_1a4c206066cbb81acef9918e84f0fbd6c4" kindref="member">gatts_cb</ref>)</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a5783c651d20f9282b8c51d1def73bc38" kindref="member">app_profile_table</ref>[i].gatts_cb(event,<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="607"><highlight class="normal">}</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ab6595366a5a836bb0ad25fe855930620" kindref="member">IO_CTRL_SERVICE_profile_handler</ref>(esp_gatts_cb_event_t<sp/>event,<sp/>esp_gatt_if_t<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>esp_ble_gatts_cb_param_t<sp/>*param)</highlight></codeline>
<codeline lineno="614"><highlight class="normal">{</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;IO_CTRL_SERVICE_profile_handler&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(event)</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>存储应用</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_REG_EVT:</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_create_attr_tab(<ref refid="sevetest30___b_w_e_d_a_8c_1a368f93fc68770506027b0b81b36414c7" kindref="member">io_ctrl_gatt_database</ref>,<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45aea0f9735f12f080d283855cf9b9395be" kindref="member">IO_CTRL_IDX_NB</ref>,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ae54f817fcc69f4bc2b95dec2288d4880" kindref="member">SVC_INST_ID</ref>);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>服务属性表创建完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CREAT_ATTR_TAB_EVT:</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;add_attr_tab.status<sp/>!=<sp/>ESP_GATT_OK)</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;创建IO_CTRL_SERVICE的服务属性表时发现问题-<sp/>0x%x&quot;</highlight><highlight class="normal">,<sp/>param-&gt;add_attr_tab.status);</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;成功创建IO_CTRL_SERVICE的服务属性表<sp/>已创建句柄数<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>param-&gt;add_attr_tab.num_handle);</highlight></codeline>
<codeline lineno="634"><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>完善句柄</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<ref refid="sevetest30___b_w_e_d_a_8c_1a6216759639ba936214a16ceed081db9f" kindref="member">io_ctrl_service_handle_table</ref>,<sp/>param-&gt;add_attr_tab.handles,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="sevetest30___b_w_e_d_a_8c_1a6216759639ba936214a16ceed081db9f" kindref="member">io_ctrl_service_handle_table</ref>));</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gatts_start_service(<ref refid="sevetest30___b_w_e_d_a_8c_1a6216759639ba936214a16ceed081db9f" kindref="member">io_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a3897a2ba75a902ba5e66403dc9e66e45a9aaa6fd7c050fa923bc14e46a58c19f7" kindref="member">IO_CTRL_SERVICE</ref>]))</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;IO_CTRL_SERVICE<sp/>服务启动失败&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;IO_CTRL_SERVICE<sp/>服务启动成功&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>读操作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_READ_EVT:</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;读操作&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>写操作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_WRITE_EVT:</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!param-&gt;write.is_prep)</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;目标句柄<sp/>%d<sp/>-<sp/>写入长度<sp/>%d,以下以HEX格式展示写入的值&quot;</highlight><highlight class="normal">,<sp/>param-&gt;write.handle,<sp/>param-&gt;write.len);</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_log_buffer_hex(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/>param-&gt;write.value,<sp/>param-&gt;write.len);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>//<sp/>特征传输配置，当客户端设定传输方式运行</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>(param-&gt;write.handle<sp/>==<sp/>io_ctrl_service_handle_table[IDX_CHAR_CFG_A]<sp/>&amp;&amp;<sp/>param-&gt;write.len<sp/>==<sp/>2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>uint16_t<sp/>descr_value<sp/>=<sp/>param-&gt;write.value[1]<sp/>&lt;&lt;<sp/>8<sp/>|<sp/>param-&gt;write.value[0];</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>if<sp/>(descr_value<sp/>==<sp/>0x0001)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(TAG,<sp/>&quot;notify启用&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>esp_ble_gatts_send_indicate(gatts_if,<sp/>param-&gt;write.conn_id,<sp/>heart_rate_handle_table[IDX_CHAR_VAL_A],</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sizeof(notify_data),<sp/>notify_data,<sp/>false);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>else<sp/>if<sp/>(descr_value<sp/>==<sp/>0x0002)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(TAG,<sp/>&quot;indicate启用&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="676"><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>esp_ble_gatts_send_indicate(gatts_if,<sp/>param-&gt;write.conn_id,<sp/>heart_rate_handle_table[IDX_CHAR_VAL_A],</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sizeof(indicate_data),<sp/>indicate_data,<sp/>true);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>else<sp/>if<sp/>(descr_value<sp/>==<sp/>0x0000)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(TAG,<sp/>&quot;notify/indicate关闭&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(TAG,<sp/>&quot;未知的传输描述：&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_log_buffer_hex(TAG,<sp/>param-&gt;write.value,<sp/>param-&gt;write.len);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>如果存在响应需求，传输响应信息</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;write.need_rsp)</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_send_response(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>param-&gt;write.conn_id,<sp/>param-&gt;write.trans_id,<sp/>ESP_GATT_OK,<sp/>NULL);</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备写操作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aaa057b814e8346f9a1057f9b719a4315" kindref="member">prepare_write_event</ref>(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="703"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_EXEC_WRITE_EVT:</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;执行写操作&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a20fb32742591c32ffaa8689c7d39ba24" kindref="member">execute_write_event</ref>(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"></highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CONNECT_EVT:</highlight></codeline>
<codeline lineno="712"><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;蓝牙连接<sp/>连接ID<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>param-&gt;connect.conn_id);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_log_buffer_hex(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/>param-&gt;connect.remote_bda,<sp/>6);</highlight></codeline>
<codeline lineno="715"><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>上传连接参数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_conn_update_params_t<sp/>conn_params<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(conn_params.bda,<sp/>param-&gt;connect.remote_bda,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(esp_bd_addr_t));</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.latency<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a29ae124ce357216241f88b749a60a9d5" kindref="member">BLE_CONNECT_SLAVE_LATENCY</ref>;</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.min_int<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a76262b6e596c21ccab308f7da2ce4ff6" kindref="member">BLE_CONNECT_MIN_INTERVAL</ref>;</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.max_int<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a3c4f6bcd8314ef06fd282842de440a9f" kindref="member">BLE_CONNECT_MAX_INTERVAL</ref>;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.timeout<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1aa83aeb0871e0a1ff9b450f53b78e5f6d" kindref="member">BLE_CONNECT_TIMEOUT</ref>;</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gap_update_conn_params(&amp;conn_params);</highlight></codeline>
<codeline lineno="724"><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>断开连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_DISCONNECT_EVT:</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;连接断开,<sp/>因为<sp/>0x%x&quot;</highlight><highlight class="normal">,<sp/>param-&gt;disconnect.reason);</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------//复位传输配置</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_MTU_EVT:<sp/></highlight><highlight class="comment">//<sp/>MTU设置完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CONF_EVT:<sp/></highlight><highlight class="comment">//<sp/>接收到确认信息</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_START_EVT:<sp/></highlight><highlight class="comment">//<sp/>启动接收完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_STOP_EVT:<sp/></highlight><highlight class="comment">//<sp/>终止接收完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_OPEN_EVT:<sp/></highlight><highlight class="comment">//<sp/>组对连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CANCEL_OPEN_EVT:<sp/></highlight><highlight class="comment">//<sp/>断开组对</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CLOSE_EVT:<sp/></highlight><highlight class="comment">//<sp/>服务关闭</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_LISTEN_EVT:<sp/></highlight><highlight class="comment">//<sp/>监听</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CONGEST_EVT:<sp/></highlight><highlight class="comment">//<sp/>拥堵</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_UNREG_EVT:<sp/></highlight><highlight class="comment">//<sp/>应用ID未存储</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_DELETE_EVT:<sp/></highlight><highlight class="comment">//<sp/>服务删除完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_SET_ATTR_VAL_EVT:<sp/></highlight><highlight class="comment">//<sp/>属性设置完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="757"><highlight class="normal"></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGW(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;其他事件触发了,但是处理方式没有被设置<sp/>-<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>event);</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="762"><highlight class="normal">}</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1af4165e8b4c92675941e0c4a497421ac6" kindref="member">MEDIA_CTRL_SERVICE_profile_handler</ref>(esp_gatts_cb_event_t<sp/>event,<sp/>esp_gatt_if_t<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>esp_ble_gatts_cb_param_t<sp/>*param)</highlight></codeline>
<codeline lineno="769"><highlight class="normal">{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;MEDIA_CTRL_SERVICE_profile_handler&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="771"><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint16_t<sp/>media_ctrl_conn_id_buf1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"></highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(event)</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>存储应用</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_REG_EVT:</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_create_attr_tab(<ref refid="sevetest30___b_w_e_d_a_8c_1abc2f05fededbd7b5dd6eecb033fe99ff" kindref="member">media_ctrl_gatt_database</ref>,<sp/><ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbae8432910de733803f8c482c3f39573fe" kindref="member">MEDIA_CTRL_IDX_NB</ref>,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ae54f817fcc69f4bc2b95dec2288d4880" kindref="member">SVC_INST_ID</ref>);</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>服务属性表创建完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CREAT_ATTR_TAB_EVT:</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;add_attr_tab.status<sp/>!=<sp/>ESP_GATT_OK)</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;创建MEDIA_CTRL_SERVICE的服务属性表时发现问题-<sp/>0x%x&quot;</highlight><highlight class="normal">,<sp/>param-&gt;add_attr_tab.status);</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;成功创建MEDIA_CTRL_SERVICE的服务属性表<sp/>已创建句柄数<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>param-&gt;add_attr_tab.num_handle);</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>完善句柄</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>,<sp/>param-&gt;add_attr_tab.handles,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>));</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gatts_start_service(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf5983682960bf9927095dcbc41fe8333" kindref="member">MEDIA_CTRL_SERVICE</ref>]))</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;MEDIA_CTRL_SERVICE<sp/>服务启动失败&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;MEDIA_CTRL_SERVICE<sp/>服务启动成功&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>数据映射到缓存</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structboard__ctrl__t" kindref="compound">board_ctrl_t</ref><sp/>*board_ctrl<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>board_ctrl<sp/>=<sp/><ref refid="board__ctrl_8h_1a5c34b0544b36577b19ab541ee651e444" kindref="member">board_status_get</ref>();</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(board_ctrl)</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_set_attr_value(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" kindref="member">MEDIA_CTRL_VOL_AMP_VALUE</ref>],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>&amp;(board_ctrl-&gt;<ref refid="structboard__ctrl__t_1ad92037e11f941ab6265efda74be5f453" kindref="member">amplifier_volume</ref>));</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_set_attr_value(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" kindref="member">MEDIA_CTRL_MUTE_AMP_VALUE</ref>],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>&amp;(board_ctrl-&gt;<ref refid="structboard__ctrl__t_1ac8b35aaf0c6f74736b097412ff655eed" kindref="member">amplifier_mute</ref>));</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>读操作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_READ_EVT:</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;读操作&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="820"><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>写操作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_WRITE_EVT:</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!param-&gt;write.is_prep)</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>特征传输配置，当客户端设定传输方式运行</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint16_t<sp/>descr_value<sp/>=<sp/>param-&gt;write.value[1]<sp/>&lt;&lt;<sp/>8<sp/>|<sp/>param-&gt;write.value[0];</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>media_ctrl_conn_id_buf1<sp/>=<sp/>param-&gt;write.conn_id;</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;write.handle<sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2470c90ab387e9b75c7d5fb01c868a16" kindref="member">MEDIA_CTRL_VOL_AMP_CFG</ref>]<sp/>&amp;&amp;<sp/>param-&gt;write.len<sp/>==<sp/>2)</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(descr_value<sp/>==<sp/>0x0000)</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>=<sp/>0x0000;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(descr_value<sp/>==<sp/>0x0001)</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a94e6830498933c86fbd3a389fae96758" kindref="member">CHAR_UUID_ACS_DATA_OUT_NOTIFY</ref>;</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(descr_value<sp/>==<sp/>0x0002)</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" kindref="member">CHAR_UUID_ACS_DATA_OUT_INDICATE</ref>;</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;write.handle<sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba7ada8457ec1fdcb054b2599468e58f41" kindref="member">MEDIA_CTRL_MUTE_AMP_CFG</ref>]<sp/>&amp;&amp;<sp/>param-&gt;write.len<sp/>==<sp/>2)</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(descr_value<sp/>==<sp/>0x0000)</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>=<sp/>0x0000;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(descr_value<sp/>==<sp/>0x0001)</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a94e6830498933c86fbd3a389fae96758" kindref="member">CHAR_UUID_ACS_DATA_OUT_NOTIFY</ref>;</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(descr_value<sp/>==<sp/>0x0002)</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" kindref="member">CHAR_UUID_ACS_DATA_OUT_INDICATE</ref>;</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="847"><highlight class="normal"></highlight></codeline>
<codeline lineno="848"><highlight class="normal"></highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>同步控制数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structboard__ctrl__t" kindref="compound">board_ctrl_t</ref>*<sp/>board_ctrl<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>board_ctrl<sp/>=<sp/><ref refid="board__ctrl_8h_1a5c34b0544b36577b19ab541ee651e444" kindref="member">board_status_get</ref>();</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(board_ctrl){</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(param-&gt;write.handle<sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" kindref="member">MEDIA_CTRL_VOL_AMP_VALUE</ref>]){</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>board_ctrl-&gt;<ref refid="structboard__ctrl__t_1ad92037e11f941ab6265efda74be5f453" kindref="member">amplifier_volume</ref><sp/>=<sp/>param-&gt;write.value[0];</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="board__ctrl_8h_1af56a4cb2a06ffa952db6fe69029d5a85" kindref="member">sevetest30_board_ctrl</ref>(board_ctrl,<ref refid="board__ctrl_8h_1a5743515e10f317337f4c19563764b3dda00ce78d0281ebf4eac8197f29b462a0c" kindref="member">BOARD_CTRL_AMPLIFIER</ref>);</highlight><highlight class="comment">//完成配置后，函数会推送数据更新，特征值会保存在本地</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(param-&gt;write.handle<sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" kindref="member">MEDIA_CTRL_MUTE_AMP_VALUE</ref>]){</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>board_ctrl-&gt;<ref refid="structboard__ctrl__t_1ac8b35aaf0c6f74736b097412ff655eed" kindref="member">amplifier_mute</ref><sp/>=<sp/>param-&gt;write.value[0];</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="board__ctrl_8h_1af56a4cb2a06ffa952db6fe69029d5a85" kindref="member">sevetest30_board_ctrl</ref>(board_ctrl,<ref refid="board__ctrl_8h_1a5743515e10f317337f4c19563764b3dda00ce78d0281ebf4eac8197f29b462a0c" kindref="member">BOARD_CTRL_AMPLIFIER</ref>);</highlight><highlight class="comment">//完成配置后，函数会推送数据更新，特征值会保存在本地</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>如果存在响应需求，传输响应信息</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(param-&gt;write.need_rsp)</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_send_response(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>param-&gt;write.conn_id,<sp/>param-&gt;write.trans_id,<sp/>ESP_GATT_OK,<sp/>NULL);</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>准备写操作</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aaa057b814e8346f9a1057f9b719a4315" kindref="member">prepare_write_event</ref>(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="875"><highlight class="normal"></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_EXEC_WRITE_EVT:</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;执行写操作&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a20fb32742591c32ffaa8689c7d39ba24" kindref="member">execute_write_event</ref>(&amp;<ref refid="sevetest30___b_w_e_d_a_8c_1a547088aee158d2a8bb8661161dd41dbd" kindref="member">prepare_write_env</ref>,<sp/>param);</highlight></codeline>
<codeline lineno="880"><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;%d&quot;</highlight><highlight class="normal">,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref>);</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="883"><highlight class="normal"></highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CONNECT_EVT:</highlight></codeline>
<codeline lineno="886"><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;蓝牙连接<sp/>连接ID<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>param-&gt;connect.conn_id);</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_log_buffer_hex(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/>param-&gt;connect.remote_bda,<sp/>6);</highlight></codeline>
<codeline lineno="889"><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>上传连接参数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_conn_update_params_t<sp/>conn_params<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(conn_params.bda,<sp/>param-&gt;connect.remote_bda,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(esp_bd_addr_t));</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.latency<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a29ae124ce357216241f88b749a60a9d5" kindref="member">BLE_CONNECT_SLAVE_LATENCY</ref>;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.min_int<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a76262b6e596c21ccab308f7da2ce4ff6" kindref="member">BLE_CONNECT_MIN_INTERVAL</ref>;</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.max_int<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1a3c4f6bcd8314ef06fd282842de440a9f" kindref="member">BLE_CONNECT_MAX_INTERVAL</ref>;</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn_params.timeout<sp/>=<sp/><ref refid="sevetest30___b_w_e_d_a_8h_1aa83aeb0871e0a1ff9b450f53b78e5f6d" kindref="member">BLE_CONNECT_TIMEOUT</ref>;</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gap_update_conn_params(&amp;conn_params);</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>断开连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_DISCONNECT_EVT:</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;连接断开,<sp/>因为<sp/>0x%x&quot;</highlight><highlight class="normal">,<sp/>param-&gt;disconnect.reason);</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>=<sp/>0x0000;<sp/></highlight><highlight class="comment">//<sp/>复位传输配置</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>=<sp/>0x0000;<sp/></highlight><highlight class="comment">//<sp/>复位传输配置</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="907"><highlight class="normal"></highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_MTU_EVT:<sp/></highlight><highlight class="comment">//<sp/>MTU设置完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CONF_EVT:<sp/></highlight><highlight class="comment">//<sp/>接收到确认信息</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_START_EVT:<sp/></highlight><highlight class="comment">//<sp/>启动接收完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_STOP_EVT:<sp/></highlight><highlight class="comment">//<sp/>终止接收完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_OPEN_EVT:<sp/></highlight><highlight class="comment">//<sp/>组对连接</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CANCEL_OPEN_EVT:<sp/></highlight><highlight class="comment">//<sp/>断开组对</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CLOSE_EVT:<sp/></highlight><highlight class="comment">//<sp/>服务关闭</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_LISTEN_EVT:<sp/></highlight><highlight class="comment">//<sp/>监听</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_CONGEST_EVT:<sp/></highlight><highlight class="comment">//<sp/>拥堵</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_UNREG_EVT:<sp/></highlight><highlight class="comment">//<sp/>应用ID未存储</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_DELETE_EVT:<sp/></highlight><highlight class="comment">//<sp/>服务删除完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ESP_GATTS_SET_ATTR_VAL_EVT:<sp/></highlight><highlight class="comment">//<sp/>属性设置完成</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="932"><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>在notify或indicate机制下主动发送数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a94e6830498933c86fbd3a389fae96758" kindref="member">CHAR_UUID_ACS_DATA_OUT_NOTIFY</ref><sp/>||<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" kindref="member">CHAR_UUID_ACS_DATA_OUT_INDICATE</ref>)</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;扬声器音量<sp/>-<sp/>%d&quot;</highlight><highlight class="normal">,<ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref>);</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_send_indicate(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>media_ctrl_conn_id_buf1,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" kindref="member">MEDIA_CTRL_VOL_AMP_VALUE</ref>],</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>&amp;(<ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref>),(<ref refid="sevetest30___b_w_e_d_a_8c_1a895d41297f8eb87435af9fdb9255c634" kindref="member">media_ctrl_cfg_buf1</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" kindref="member">CHAR_UUID_ACS_DATA_OUT_INDICATE</ref>));</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a94e6830498933c86fbd3a389fae96758" kindref="member">CHAR_UUID_ACS_DATA_OUT_NOTIFY</ref><sp/>||<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" kindref="member">CHAR_UUID_ACS_DATA_OUT_INDICATE</ref>)</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGI(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;静音扬声器<sp/>-<sp/>%d&quot;</highlight><highlight class="normal">,<ref refid="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" kindref="member">media_ctrl_amp_mute_buf</ref>);</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_send_indicate(<ref refid="structgatts__profile__inst_1a204e85b33c0e3e45197e21bc52d89d22" kindref="member">gatts_if</ref>,<sp/>media_ctrl_conn_id_buf1,<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" kindref="member">MEDIA_CTRL_MUTE_AMP_VALUE</ref>],</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>&amp;(<ref refid="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" kindref="member">media_ctrl_amp_mute_buf</ref>),(<ref refid="sevetest30___b_w_e_d_a_8c_1a70209274ce20685066c040a6c2ae1ad5" kindref="member">media_ctrl_cfg_buf2</ref><sp/>==<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a4160274d0929e2527596a35a22932b67" kindref="member">CHAR_UUID_ACS_DATA_OUT_INDICATE</ref>));<sp/><sp/></highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="946"><highlight class="normal"></highlight></codeline>
<codeline lineno="947"><highlight class="normal"></highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="950"><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGW(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;其他事件触发了,但是处理方式没有被设置<sp/>-<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>event);</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="955"><highlight class="normal">}</highlight></codeline>
<codeline lineno="956"><highlight class="normal"></highlight></codeline>
<codeline lineno="959"><highlight class="normal">esp_err_t<sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ab02c566320eb5bed70fe514db11915b8" kindref="member">bluetooth_connect</ref>()</highlight></codeline>
<codeline lineno="960"><highlight class="normal">{</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;bluetooth_connect&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="962"><highlight class="normal"></highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>初始化NVS存储</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_err_t<sp/>ret<sp/>=<sp/>nvs_flash_init();</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>==<sp/>ESP_ERR_NVS_NO_FREE_PAGES<sp/>||<sp/>ret<sp/>==<sp/>ESP_ERR_NVS_NEW_VERSION_FOUND)</highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_ERROR_CHECK(nvs_flash_erase());</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/>nvs_flash_init();</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/>ESP_ERROR_CHECK(ret);</highlight></codeline>
<codeline lineno="971"><highlight class="normal"></highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>因为只使用BLE,释放经典蓝牙的缓存，这个操作不可逆</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_bt_controller_mem_release(ESP_BT_MODE_CLASSIC_BT))</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;释放经典蓝牙的缓存时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="978"><highlight class="normal"></highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>初始化蓝牙硬件控制器</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/>esp_bt_controller_config_t<sp/>bt_cfg<sp/>=<sp/>BT_CONTROLLER_INIT_CONFIG_DEFAULT();</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_bt_controller_init(&amp;bt_cfg))</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;初始化蓝牙硬件控制器时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="986"><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>使能蓝牙硬件控制器</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_bt_controller_enable(ESP_BT_MODE_BLE))</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;使能蓝牙硬件控制器时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="993"><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>初始化蓝牙API并申请资源</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_bluedroid_init())</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;初始化蓝牙API并申请资源时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>启动蓝牙API</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_bluedroid_enable())</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;启动蓝牙API时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>为GATTS安装回调函数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gatts_register_callback(<ref refid="sevetest30___b_w_e_d_a_8c_1aae8ed4e25351ba801179f79d655923ab" kindref="member">gatts_event_handler</ref>))</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;为GATTS安装回调时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>为GAP安装回调函数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gap_register_callback(<ref refid="sevetest30___b_w_e_d_a_8c_1a50ba83bf77cdec4ac247bf44f357f310" kindref="member">gap_event_handler</ref>))</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;为GAP安装回调时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"></highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>注册应用标识APP_ID,这是一个自用识别参数</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gatts_app_register(<ref refid="sevetest30___b_w_e_d_a_8c_1a7f58e13befd440c6ec2fba126a64c013" kindref="member">ESP_APP_ID</ref>))</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;注册应用标识APP_ID时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"></highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>设置最大可传输单元MTU限制大小</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esp_ble_gatt_set_local_mtu(<ref refid="sevetest30___b_w_e_d_a_8h_1a46f77d4804b68845a719609014a1d262" kindref="member">BLE_LOCAL_MTU</ref>))</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ESP_LOGE(<ref refid="board_8c_1a5a85b9c772bbeb480b209a3e6ea92b4c" kindref="member">TAG</ref>,<sp/></highlight><highlight class="stringliteral">&quot;设置本地MTU时发现问题&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_FAIL;</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"></highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ESP_OK;</highlight></codeline>
<codeline lineno="1037"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"></highlight></codeline>
<codeline lineno="1040"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1a94cf65820705e7bcbf213cc8fd1f66d2" kindref="member">sevetest30_ble_attr_value_push</ref>()</highlight></codeline>
<codeline lineno="1041"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structboard__ctrl__t" kindref="compound">board_ctrl_t</ref><sp/>*board_ctrl<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/>board_ctrl<sp/>=<sp/><ref refid="board__ctrl_8h_1a5c34b0544b36577b19ab541ee651e444" kindref="member">board_status_get</ref>();</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(board_ctrl)</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>数据映射到缓存,属性设置完成触发ESP_GATTS_SET_ATTR_VAL_EVT事件，在对应配置回调再向客户端主动推送数据</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref><sp/>=<sp/>board_ctrl-&gt;<ref refid="structboard__ctrl__t_1ad92037e11f941ab6265efda74be5f453" kindref="member">amplifier_volume</ref>;</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_set_attr_value(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcbaf0cdbaf4941db626a115765891a03c05" kindref="member">MEDIA_CTRL_VOL_AMP_VALUE</ref>],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>&amp;(<ref refid="sevetest30___b_w_e_d_a_8c_1aa3675ed8aebbd623b243b1e4a902861b" kindref="member">media_ctrl_amp_vol_buf</ref>));</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"></highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" kindref="member">media_ctrl_amp_mute_buf</ref><sp/>=<sp/>board_ctrl-&gt;<ref refid="structboard__ctrl__t_1ac8b35aaf0c6f74736b097412ff655eed" kindref="member">amplifier_mute</ref>;</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esp_ble_gatts_set_attr_value(<ref refid="sevetest30___b_w_e_d_a_8c_1a803279e740d3ff740db91c5ed729c2ee" kindref="member">media_ctrl_service_handle_table</ref>[<ref refid="sevetest30___b_w_e_d_a_8c_1a0a20b8617c2adfda03d54508ff5fcfcba2b236f8a7b06e7a934a322d8e2d91910" kindref="member">MEDIA_CTRL_MUTE_AMP_VALUE</ref>],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t),<sp/>&amp;(<ref refid="sevetest30___b_w_e_d_a_8c_1ac604ecf82ebef50dd8205c04c55db7db" kindref="member">media_ctrl_amp_mute_buf</ref>));</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1055"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="main/sevetest30_BWEDA.c"/>
  </compounddef>
</doxygen>
